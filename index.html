<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RHADZOR Calendar PRO v3</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rhadzor Cal">
    
    <!-- Link ke Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icon (Opsional: Ganti URL dengan icon milikmu) -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --premium-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --gold-gradient: linear-gradient(135deg, #d97706 0%, #fbbf24 100%);
            --romance-gradient: linear-gradient(135deg, #be185d 0%, #ec4899 100%);
            --accent-blue: #3b82f6;
            --bg-slate: #f1f5f9;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            height: 100dvh;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .app-container {
            width: 100%;
            max-width: 448px;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .header-rhadzor {
            background: var(--premium-gradient);
            padding: 0 1rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 20;
            height: 70px;
            padding-top: env(safe-area-inset-top); /* Support notch iPhone/Android modern */
        }

        .header-left, .header-right {
            width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .nav-row-compact {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .month-year-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            white-space: nowrap;
        }

        .nav-arrow {
            padding: 0.5rem;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
            font-size: 0.9rem;
        }
        .nav-arrow:hover { opacity: 1; }

        .btn-today-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-today-icon:hover { background: rgba(255,255,255,0.25); }

        .btn-setting {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            cursor: pointer;
            font-size: 1.1rem;
            transition: opacity 0.2s;
        }
        .btn-setting:hover { opacity: 1; }

        .hijri-label {
            font-size: 0.6rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.6;
            margin-top: 0.1rem;
            color: #cbd5e1;
        }

        .btn-floating-search {
            position: absolute;
            bottom: 6rem;
            right: 1.5rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            cursor: move;
            z-index: 30;
            transition: background 0.2s, transform 0.1s;
            border: 1px solid rgba(255,255,255,0.2);
            touch-action: none;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 6rem;
            scrollbar-width: none;
        }
        .main-content::-webkit-scrollbar { display: none; }

        .calendar-card {
            background: #f8fafc;
            border-radius: 24px;
            box-shadow: 8px 8px 16px #cbd5e1, -8px -8px 16px #ffffff;
            padding: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
        }

        .calendar-grid-container {
            width: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day-label {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 800;
            color: #64748b;
            padding-bottom: 0.75rem;
            text-transform: uppercase;
        }

        .day-cell {
            aspect-ratio: 1/1.1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            color: #1e293b;
            border: 1px solid transparent;
        }

        .day-cell.today {
            background: var(--premium-gradient);
            color: white !important;
            box-shadow: 0 8px 16px rgba(30, 27, 75, 0.25);
            transform: scale(1.02);
            z-index: 2;
        }

        .day-cell.birthday { background: var(--gold-gradient); color: white !important; border: 2px solid white; z-index: 3; }
        .day-cell.anniversary { background: var(--romance-gradient); color: white !important; border: 2px solid white; z-index: 3; }

        .day-cell.sunday, .day-cell.holiday { color: #ef4444; }
        .day-cell.friday { color: #059669; }

        .hijri-text {
            font-size: 0.5rem;
            position: absolute;
            top: 4px;
            right: 5px; 
            opacity: 0.5;
            font-weight: 400;
        }

        .pasaran-text {
            font-size: 0.5rem;
            font-weight: 500;
            opacity: 0.6;
            margin-top: 4px;
        }

        .cuti-dot { position: absolute; bottom: 2px; right: -6px; width: 5px; height: 5px; background: #ef4444; border-radius: 50%; }
        .obs-dot { position: absolute; bottom: 2px; left: -6px; width: 5px; height: 5px; background: #3b82f6; border-radius: 50%; }

        .holiday-item, .observance-item, .birthday-item, .anniversary-item {
            padding: 0.85rem 1rem;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 0.5rem;
            border-left: 4px solid transparent;
        }

        .holiday-item { border-left-color: #ef4444; }
        .observance-item { border-left-color: #3b82f6; }
        .birthday-item { border-left-color: #d97706; background: #fffbeb; }
        .anniversary-item { border-left-color: #be185d; background: #fdf2f8; }

        .footer-rhadzor {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
            padding: 1rem;
            padding-bottom: calc(1rem + env(safe-area-inset-bottom));
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 1px solid #e2e8f0;
            gap: 0.75rem;
            z-index: 10;
        }

        .rhadzor-logo {
            width: 28px;
            height: 28px;
            background: var(--premium-gradient);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 0.9rem;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: flex-end;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active { display: flex; opacity: 1; }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 448px;
            border-top-left-radius: 28px;
            border-top-right-radius: 28px;
            padding: 1.5rem;
            padding-bottom: calc(1.5rem + env(safe-area-inset-bottom));
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .modal-content { transform: translateY(0); }

        .scroller-wrapper {
            position: relative;
            height: 220px;
            overflow: hidden;
            mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            margin: 1rem 0;
            display: flex;
        }

        .scroller-col {
            flex: 1;
            height: 100%;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 85px 0;
            scrollbar-width: none;
            text-align: center;
            scroll-snap-type: y mandatory;
        }
        .scroller-col::-webkit-scrollbar { display: none; }

        .scroller-item {
            padding: 10px;
            font-size: 1.1rem;
            font-weight: 500;
            color: #94a3b8;
            transition: all 0.3s;
            opacity: 0.5;
            scroll-snap-align: center;
        }

        .scroller-item.active {
            font-size: 1.5rem;
            font-weight: 800;
            color: #0f172a;
            transform: scale(1.1);
            opacity: 1;
        }

        .toggle-switch {
            appearance: none;
            width: 44px;
            height: 24px;
            background: #cbd5e1;
            border-radius: 99px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toggle-switch:checked { background: #3b82f6; }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .toggle-switch:checked::after { transform: translateX(20px); }

        .hidden-element { display: none !important; }
    </style>
</head>
<body>

<div class="app-container">
    <header class="header-rhadzor">
        <div class="header-left">
            <div class="btn-setting" onclick="openSettings()">
                <i class="fas fa-cog"></i>
            </div>
        </div>

        <div class="header-center">
            <div class="nav-row-compact">
                <div class="nav-arrow" onclick="changeMonth(-1)">
                    <i class="fas fa-chevron-left"></i>
                </div>
                
                <div class="month-year-title">
                    <span class="unit-wrapper" id="monthLabel" onclick="openMonthSelector()">JANUARI</span>
                    <span class="unit-wrapper" id="yearLabel" onclick="openYearSelector()">2026</span>
                </div>

                <div class="nav-arrow" onclick="changeMonth(1)">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            <div class="hijri-label" id="hijriRange">RAJAB - SYA'BAN</div>
        </div>
        
        <div class="header-right">
            <div class="btn-today-icon" onclick="goToToday()">
                <i class="fas fa-calendar-day text-sm"></i>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="calendar-card" id="swipeArea">
            <div class="calendar-grid-container" id="gridContainer">
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>

        <div class="space-y-2" id="holidayContainer"></div>

        <div class="quote-minimalist mt-10 text-center px-6">
            <p class="quote-text text-sm text-slate-500 italic leading-relaxed" id="quoteDisplay"></p>
        </div>
    </main>

    <div id="searchBtn" class="btn-floating-search" onclick="handleSearchClick()">
        <i class="fas fa-search"></i>
    </div>

    <footer class="footer-rhadzor">
        <div class="rhadzor-logo">R</div>
        <span class="text-xs font-black tracking-[0.2em] text-slate-800 uppercase">RHADZOR</span>
    </footer>
</div>

<!-- Modal -->
<div class="modal-overlay" id="selectorModal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-6"></div>
        <h3 id="modalTitle" class="text-center font-bold text-slate-800 mb-2 uppercase text-xs tracking-widest hidden">JUDUL</h3>
        <div id="modalBody" class="w-full"></div>
    </div>
</div>

<script>
    // Konfigurasi PWA: Service Worker Register (Opsional untuk offline)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js').then(() => {
                console.log('Service Worker Registered');
            }).catch(err => console.log('SW Registration failed', err));
        });
    }

    const quotes = [
        "Semakin kita mencari kebahagiaan, semakin jauh ia menghilang.", "Kegagalan terbesar adalah tidak pernah mencoba.", "Kata-kata terlembut bisa melukai paling dalam.", "Diam terkadang lebih berisik daripada teriakan.", "Kehilangan mengajarkan kita nilai memiliki.", "Menerima adalah cara terkuat untuk melawan.", "Waktu sembuhkan luka, waktu juga ciptakan luka.", "Memberi adalah cara terbaik menerima.", "Memaafkan membebaskan yang memaafkan.", "Kebenaran menyakitkan lebih baik dari kebohongan manis.", "Semakin keras kita pegang, semakin mudah lepas.", "Kegelapan mengajarkan kita menghargai cahaya.", "Mendengar lebih sulit daripada berbicara.", "Kesuksesan dimulai dari kegagalan berulang.", "Melambat terkadang cara tercepat sampai tujuan.", "Kebahagiaan sejati datang dari dalam, bukan luar.", "Waktu tidak bisa dibeli tapi sering kita sia-siakan.", "Kesempurnaan adalah musuh dari kemajuan.", "Kebencian meracuni yang membenci.", "Mimpi tanpa aksi hanya angan-angan.", "Kesabaran adalah kekuatan yang tersembunyi."
    ];

    const familyBirthdays = [
        { name: "Rhadzor", day: 28, month: 5, year: 1986 },
        { name: "Lisa Istri Tercinta ‚ù§Ô∏è‚ù§Ô∏è", day: 22, month: 6, year: 1988 },
        { name: "Alby", day: 3, month: 8, year: 2013 },
        { name: "Meka", day: 2, month: 3, year: 2020 },
        { name: "Sansa", day: 21, month: 3, year: 2022 }
    ];

    const weddingAnniversary = { day: 23, month: 11, year: 2012 };

    const holidaysData = {
        2025: {
            0: { 1: "Tahun Baru 2025", 27: "Isra Mikraj", 29: "Imlek" },
            2: { 29: "Hari Suci Nyepi", 31: "Idul Fitri" },
            3: { 1: "Idul Fitri", 18: "Wafat Yesus Kristus", 20: "Paskah" },
            4: { 1: "Hari Buruh", 12: "Waisak", 29: "Kenaikan Yesus Kristus" },
            5: { 1: "Hari Lahir Pancasila", 6: "Idul Adha", 27: "Tahun Baru Islam" },
            7: { 17: "HUT RI" },
            8: { 5: "Maulid Nabi" },
            11: { 25: "Natal" }
        },
        2026: {
            0: { 1: "Tahun Baru 2026", 16: "Isra Mikraj" },
            1: { 17: "Imlek" },
            2: { 19: "Nyepi", 21: "Idul Fitri", 22: "Idul Fitri" },
            3: { 3: "Wafat Yesus Kristus", 5: "Paskah" },
            4: { 1: "Hari Buruh", 14: "Kenaikan Yesus Kristus", 27: "Idul Adha", 31: "Waisak" },
            5: { 1: "Hari Lahir Pancasila", 16: "Tahun Baru Islam" },
            7: { 17: "HUT RI", 25: "Maulid Nabi" },
            11: { 25: "Natal" }
        }
    };

    const cutiBersamaData = {
        2025: { 0:{28:"Cuti Imlek"}, 2:{28:"Cuti Nyepi"}, 3:{2:"Cuti Idul Fitri", 3:"Cuti Idul Fitri", 4:"Cuti Idul Fitri", 7:"Cuti Idul Fitri"}, 4:{13:"Cuti Waisak", 30:"Cuti Kenaikan"}, 5:{9:"Cuti Idul Adha"}, 7:{18:"Cuti HUT RI"}, 11:{26:"Cuti Natal"} },
        2026: { 1:{16:"Cuti Imlek"}, 2:{18:"Cuti Nyepi", 20:"Cuti Idul Fitri", 23:"Cuti Idul Fitri", 24:"Cuti Idul Fitri"}, 4:{15:"Cuti Kenaikan", 28:"Cuti Idul Adha"}, 11:{24:"Cuti Natal"} }
    };

    const nationalObservances = {
        0: { 3:"Hari Amal Bhakti", 15:"Hari Dharma Samudera", 25:"Hari Gizi Nasional" },
        1: { 9:"Hari Pers Nasional", 14:"Hari PETA", 21:"Hari Peduli Sampah" },
        2: { 1:"Serangan Umum 1 Maret", 9:"Hari Musik Nasional", 30:"Hari Film Nasional" },
        3: { 21:"Hari Kartini" },
        4: { 2:"Hardiknas", 20:"Harkitnas" },
        5: { 29:"Hari KB" },
        6: { 1:"Hari Bhayangkara", 23:"Hari Anak Nasional" },
        7: { 14:"Hari Pramuka" },
        8: { 9:"Hari Olahraga Nasional", 17:"Hari Perhubungan Nasional", 24:"Hari Tani Nasional", 30:"G30S/PKI" },
        9: { 1:"Hari Kesaktian Pancasila", 2:"Hari Batik Nasional", 5:"Hari TNI", 28:"Hari Sumpah Pemuda" },
        10: { 10:"Hari Pahlawan", 12:"Hari Kesehatan / Hari Ayah", 25:"Hari Guru", 29:"Hari Korpri" },
        11: { 22:"Hari Ibu" }
    };

    const hijriMonths = ["MUHARRAM", "SAFAR", "RABIUL AWAL", "RABIUL AKHIR", "JUMADIL AWAL", "JUMADIL AKHIR", "RAJAB", "SYA'BAN", "RAMADHAN", "SYAWAL", "DZULQA'DAH", "DZULHIJJAH"];
    const pasaranArr = ["LEGI", "PAHING", "PON", "WAGE", "KLIWON"];
    const monthNames = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
    const dayNames = ["MINGGU", "SENIN", "SELASA", "RABU", "KAMIS", "JUMAT", "SABTU"];
    const dayShortNames = ["MGG", "SEN", "SEL", "RAB", "KAM", "JUM", "SAB"];

    let currentDate = new Date();
    let isAnimating = false;
    let isDragging = false;
    let settings = { showHijri: true, showPasaran: true, showObservances: true, showFamily: true };

    function init() {
        renderCalendar();
        updateQuote();
        setupSwipe();
        setupDrag();
    }

    function setupDrag() {
        const btn = document.getElementById('searchBtn');
        let offsetX, offsetY;
        btn.addEventListener('touchstart', (e) => {
            isDragging = false;
            const touch = e.touches[0];
            const rect = btn.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
        });
        btn.addEventListener('touchmove', (e) => {
            isDragging = true;
            e.preventDefault();
            const touch = e.touches[0];
            const x = touch.clientX - offsetX;
            const y = touch.clientY - offsetY;
            btn.style.left = `${Math.min(Math.max(0, x), window.innerWidth - 56)}px`;
            btn.style.top = `${Math.min(Math.max(0, y), window.innerHeight - 56)}px`;
            btn.style.bottom = 'auto'; btn.style.right = 'auto';
        });
    }

    function handleSearchClick() { if (!isDragging) openDateSearch(); }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        document.getElementById('monthLabel').textContent = monthNames[month];
        document.getElementById('yearLabel').textContent = year;
        
        const hijriIdx1 = (month + 6) % 12;
        const hijriIdx2 = (month + 7) % 12;
        const hijriLabelEl = document.getElementById('hijriRange');
        hijriLabelEl.textContent = `${hijriMonths[hijriIdx1]} - ${hijriMonths[hijriIdx2]}`;
        hijriLabelEl.style.display = settings.showHijri ? 'block' : 'none';

        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        dayShortNames.forEach(d => {
            const el = document.createElement('div');
            el.className = 'day-label'; el.textContent = d;
            grid.appendChild(el);
        });

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div'));

        for (let d = 1; d <= daysInMonth; d++) {
            const dateObj = new Date(year, month, d);
            const isToday = d === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear();
            const dayOfWeek = dateObj.getDay();
            const holidayName = holidaysData[year]?.[month]?.[d];
            const cutiName = cutiBersamaData[year]?.[month]?.[d];
            const observanceName = settings.showObservances ? nationalObservances[month]?.[d] : null;
            const birthdayData = settings.showFamily ? familyBirthdays.find(b => b.day === d && b.month === month) : null;
            const anniversaryData = settings.showFamily ? (weddingAnniversary.day === d && weddingAnniversary.month === month) : null;

            const refDate = new Date(2026, 0, 1);
            const diff = Math.floor((dateObj - refDate) / 86400000);
            const pasaranIdx = (3 + (diff % 5) + 5) % 5;
            const hijriDateNum = ((d + 12) % 30) + 1;

            const cell = document.createElement('div');
            let cellClass = `day-cell ${isToday ? 'today' : ''}`;
            if (anniversaryData) cellClass += ' anniversary';
            else if (birthdayData) cellClass += ' birthday';
            else if (dayOfWeek === 0 || holidayName) cellClass += ' sunday';
            else if (dayOfWeek === 5) cellClass += ' friday';
            
            cell.className = cellClass;
            cell.id = isToday ? 'currentDayCell' : '';
            cell.innerHTML = `
                <span class="${settings.showHijri ? 'hijri-text' : 'hidden'}">${hijriDateNum}</span>
                <span class="date-wrapper">${d}${cutiName ? '<div class="cuti-dot"></div>' : ''}${observanceName ? '<div class="obs-dot"></div>' : ''}</span>
                <span class="${settings.showPasaran ? 'pasaran-text' : 'hidden'}">${pasaranArr[pasaranIdx]}</span>
            `;
            cell.onclick = () => showDetail(d, month, year, dayNames[dayOfWeek], pasaranArr[pasaranIdx], hijriDateNum, hijriMonths[hijriDateNum < 15 ? hijriIdx1 : hijriIdx2], holidayName, cutiName, observanceName, dayOfWeek===0, birthdayData, anniversaryData);
            grid.appendChild(cell);
        }
        renderEventsList(month, year);
    }

    function renderEventsList(month, year) {
        const container = document.getElementById('holidayContainer');
        container.innerHTML = '';
        if (settings.showFamily && weddingAnniversary.month === month) {
            const div = document.createElement('div');
            div.className = 'anniversary-item flex justify-between items-center';
            div.innerHTML = `<div class="flex flex-col"><span class="text-[0.7rem] font-bold text-pink-800">${weddingAnniversary.day} ${monthNames[month]}</span><span class="text-[0.6rem] text-pink-600 font-semibold">Anniversary Pernikahan ‚ù§Ô∏è</span></div><span class="text-[0.65rem] font-bold text-pink-700 bg-pink-100 px-2 py-1 rounded-full">Ke-${year - weddingAnniversary.year}</span>`;
            container.appendChild(div);
        }
        if (settings.showFamily) {
            familyBirthdays.filter(b => b.month === month).forEach(b => {
                const div = document.createElement('div');
                div.className = 'birthday-item flex justify-between items-center';
                div.innerHTML = `<div class="flex flex-col"><span class="text-[0.7rem] font-bold text-amber-800">${b.day} ${monthNames[month]}</span><span class="text-[0.6rem] text-amber-600 font-semibold">Ulang Tahun ${b.name}</span></div><span class="text-[0.65rem] font-bold text-amber-700 bg-amber-100 px-2 py-1 rounded-full">Ke-${year - b.year}</span>`;
                container.appendChild(div);
            });
        }
        const events = [];
        if (holidaysData[year]?.[month]) Object.keys(holidaysData[year][month]).forEach(d => events.push({day: d, name: holidaysData[year][month][d], type: 'h'}));
        if (cutiBersamaData[year]?.[month]) Object.keys(cutiBersamaData[year][month]).forEach(d => events.push({day: d, name: cutiBersamaData[year][month][d], type: 'c'}));
        if (settings.showObservances && nationalObservances[month]) Object.keys(nationalObservances[month]).forEach(d => events.push({day: d, name: nationalObservances[month][d], type: 'o'}));
        events.sort((a,b) => a.day - b.day).forEach(e => {
            const div = document.createElement('div');
            div.className = `${e.type==='o' ? 'observance-item' : 'holiday-item'} flex justify-between items-center`;
            div.innerHTML = `<span class="text-[0.7rem] font-bold text-slate-800">${e.day} ${monthNames[month]}</span><span class="text-[0.65rem] ${e.type==='o'?'text-blue-600':'text-red-600'} font-medium text-right">${e.name}</span>`;
            container.appendChild(div);
        });
    }

    function changeMonth(dir) {
        if (isAnimating) return;
        isAnimating = true;
        const container = document.getElementById('gridContainer');
        container.style.opacity = '0';
        setTimeout(() => {
            currentDate.setDate(1);
            currentDate.setMonth(currentDate.getMonth() + dir);
            renderCalendar(); updateQuote();
            container.style.opacity = '1';
            setTimeout(() => isAnimating = false, 400);
        }, 200);
    }

    function showDetail(d, m, y, dayName, pasaranName, hDate, hMonth, holiday, cuti, obs, isRed, bDay, anniv) {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.add('hidden');
        body.className = "p-4 text-center";
        
        let colorClass = isRed ? "text-red-600" : "text-slate-900";
        if (bDay) colorClass = "text-amber-600";
        if (anniv) colorClass = "text-pink-600";

        let badges = '';
        if (holiday) badges += `<div class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-[0.65rem] font-bold mb-2">${holiday}</div>`;
        if (cuti) badges += `<div class="bg-red-50 text-red-500 px-3 py-1 rounded-full text-[0.65rem] font-bold mb-2">${cuti}</div>`;
        if (obs) badges += `<div class="bg-blue-50 text-blue-500 px-3 py-1 rounded-full text-[0.65rem] font-bold mb-2">${obs}</div>`;
        if (bDay) badges += `<div class="bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-[0.65rem] font-bold mb-2">üéâ ULTAH ${bDay.name}</div>`;
        if (anniv) badges += `<div class="bg-pink-100 text-pink-700 px-3 py-1 rounded-full text-[0.65rem] font-bold mb-2">üíç ANNIVERSARY KE-${y - weddingAnniversary.year}</div>`;

        body.innerHTML = `
            <div class="mb-6">
                <div class="text-6xl font-black ${colorClass} leading-none">${d}</div>
                <div class="text-xs font-bold text-slate-400 uppercase mt-2">${monthNames[m]} ${y}</div>
                <div class="flex flex-wrap justify-center gap-1 mt-3">${badges}</div>
            </div>
            <div class="bg-slate-50 border border-slate-100 rounded-3xl p-6">
                <div class="text-xl font-black text-slate-800 uppercase">${dayName} ${settings.showPasaran ? pasaranName : ''}</div>
                <div class="text-sm font-medium text-slate-500 mt-1">${settings.showHijri ? hDate + ' ' + hMonth + ' 1447H' : ''}</div>
            </div>
            <p class="mt-6 text-sm italic text-slate-500 px-4">"${quotes[Math.floor(Math.random()*quotes.length)]}"</p>
        `;
        openModal();
    }

    function openSettings() {
        const body = document.getElementById('modalBody');
        document.getElementById('modalTitle').classList.remove('hidden');
        document.getElementById('modalTitle').textContent = "PENGATURAN";
        body.className = "p-4 space-y-4";
        const options = [
            {id:'showPasaran', label:'Tanggal Jawa'},
            {id:'showHijri', label:'Tanggal Hijriah'},
            {id:'showObservances', label:'Hari Peringatan'},
            {id:'showFamily', label:'Hari Keluarga'}
        ];
        body.innerHTML = options.map(opt => `
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-2xl">
                <span class="font-bold text-sm text-slate-700">${opt.label}</span>
                <input type="checkbox" class="toggle-switch" ${settings[opt.id] ? 'checked' : ''} onchange="settings.${opt.id}=!settings.${opt.id}; renderCalendar();">
            </div>
        `).join('');
        openModal();
    }

    function openMonthSelector() {
        const body = document.getElementById('modalBody');
        document.getElementById('modalTitle').classList.remove('hidden');
        document.getElementById('modalTitle').textContent = "PILIH BULAN";
        body.className = "grid grid-cols-3 gap-3 p-2";
        body.innerHTML = monthNames.map((m, i) => `
            <div onclick="currentDate.setMonth(${i}); renderCalendar(); closeModal();" class="p-3 text-center rounded-xl font-bold text-[0.7rem] ${currentDate.getMonth()===i ? 'bg-slate-900 text-white' : 'bg-slate-50 text-slate-600'}">
                ${m}
            </div>
        `).join('');
        openModal();
    }

    function openYearSelector() {
        const body = document.getElementById('modalBody');
        document.getElementById('modalTitle').classList.remove('hidden');
        document.getElementById('modalTitle').textContent = "PILIH TAHUN";
        body.className = "p-4";
        const curY = currentDate.getFullYear();
        body.innerHTML = `
            <div class="scroller-wrapper">
                <div class="absolute top-1/2 left-0 w-full h-12 border-y border-slate-100 -translate-y-1/2 -z-10 bg-slate-50"></div>
                <div class="scroller-col" id="yearScroll">
                    ${Array.from({length: 201}, (_, i) => 1950 + i).map(y => `<div class="scroller-item ${y===curY?'active':''}" data-val="${y}">${y}</div>`).join('')}
                </div>
            </div>
            <button onclick="currentDate.setFullYear(parseInt(document.querySelector('#yearScroll .active').dataset.val)); renderCalendar(); closeModal();" class="w-full mt-4 bg-slate-900 text-white py-4 rounded-2xl font-bold text-xs">PILIH TAHUN</button>
        `;
        openModal();
        setupScroller('yearScroll');
    }

    function openDateSearch() {
        const body = document.getElementById('modalBody');
        document.getElementById('modalTitle').classList.remove('hidden');
        document.getElementById('modalTitle').textContent = "CARI TANGGAL";
        const curM = currentDate.getMonth();
        const curY = currentDate.getFullYear();
        body.innerHTML = `
            <div class="scroller-wrapper">
                <div class="absolute top-1/2 left-0 w-full h-12 border-y border-slate-100 -translate-y-1/2 -z-10 bg-slate-50"></div>
                <div class="scroller-col" id="mScroll">${monthNames.map((m,i)=>`<div class="scroller-item ${i===curM?'active':''}" data-val="${i}">${m}</div>`).join('')}</div>
                <div class="scroller-col" id="yScroll">${Array.from({length: 101}, (_, i) => curY-50+i).map(y => `<div class="scroller-item ${y===curY?'active':''}" data-val="${y}">${y}</div>`).join('')}</div>
            </div>
            <button onclick="jumpToDate()" class="w-full mt-4 bg-slate-900 text-white py-4 rounded-2xl font-bold text-xs">LIHAT KALENDER</button>
        `;
        openModal();
        setupScroller('mScroll'); setupScroller('yScroll');
    }

    function jumpToDate() {
        currentDate.setMonth(parseInt(document.querySelector('#mScroll .active').dataset.val));
        currentDate.setFullYear(parseInt(document.querySelector('#yScroll .active').dataset.val));
        renderCalendar(); updateQuote(); closeModal();
    }

    function setupScroller(id) {
        const el = document.getElementById(id);
        const active = el.querySelector('.active');
        if(active) el.scrollTop = active.offsetTop - el.offsetHeight/2 + active.offsetHeight/2;
        el.onscroll = () => {
            const items = el.querySelectorAll('.scroller-item');
            const center = el.scrollTop + el.offsetHeight/2;
            items.forEach(item => {
                const diff = Math.abs(center - (item.offsetTop + item.offsetHeight/2));
                item.classList.toggle('active', diff < 25);
            });
        };
    }

    function goToToday() { currentDate = new Date(); renderCalendar(); }
    function updateQuote() { document.getElementById('quoteDisplay').textContent = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`; }
    function openModal() { document.getElementById('selectorModal').classList.add('active'); }
    function closeModal() { document.getElementById('selectorModal').classList.remove('active'); }
    function setupSwipe() {
        let startX = 0;
        const area = document.getElementById('swipeArea');
        area.addEventListener('touchstart', e => startX = e.touches[0].clientX);
        area.addEventListener('touchend', e => {
            const diff = e.changedTouches[0].clientX - startX;
            if(Math.abs(diff) > 50) changeMonth(diff > 0 ? -1 : 1);
        });
    }

    window.onload = init;
</script>
</body>
</html>
