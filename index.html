<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RHADZOR Calendar PRO v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --premium-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --gold-gradient: linear-gradient(135deg, #d97706 0%, #fbbf24 100%);
            --romance-gradient: linear-gradient(135deg, #be185d 0%, #ec4899 100%);
            --accent-blue: #3b82f6;
            --bg-slate: #f1f5f9;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            height: 100dvh;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .app-container {
            width: 100%;
            max-width: 448px;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .header-rhadzor {
            background: var(--premium-gradient);
            padding: 0 1rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 20;
            height: 70px;
        }

        .header-left, .header-right {
            width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .nav-row-compact {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .month-year-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            white-space: nowrap;
        }

        .nav-arrow {
            padding: 0.5rem;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
            font-size: 0.9rem;
        }
        .nav-arrow:hover { opacity: 1; }

        .btn-today-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-today-icon:hover { background: rgba(255,255,255,0.25); }

        .btn-setting {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            cursor: pointer;
            font-size: 1.1rem;
            transition: opacity 0.2s;
        }
        .btn-setting:hover { opacity: 1; }

        .hijri-label {
            font-size: 0.6rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.6;
            margin-top: 0.1rem;
            color: #cbd5e1;
        }

        .btn-floating-search {
            position: absolute;
            bottom: 5rem;
            right: 1.5rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            cursor: move;
            z-index: 30;
            transition: background 0.2s, transform 0.1s;
            border: 1px solid rgba(255,255,255,0.2);
            touch-action: none;
        }
        
        .btn-floating-search:active { 
            background: rgba(15, 23, 42, 0.6); 
            transform: scale(0.95);
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 5rem;
            scrollbar-width: none;
        }
        .main-content::-webkit-scrollbar { display: none; }

        .calendar-card {
            background: #f8fafc;
            border-radius: 24px;
            box-shadow: 8px 8px 16px #cbd5e1, -8px -8px 16px #ffffff;
            padding: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
            perspective: 1200px;
        }

        .calendar-grid-container {
            width: 100%;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day-label {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 800;
            color: #64748b;
            padding-bottom: 0.75rem;
            text-transform: uppercase;
        }

        .day-cell {
            aspect-ratio: 1/1.1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            color: #1e293b;
            border: 1px solid transparent;
        }
        
        .day-cell:active { transform: scale(0.95); }

        .day-cell.today {
            background: var(--premium-gradient);
            color: white !important;
            box-shadow: 0 8px 16px rgba(30, 27, 75, 0.25);
            transform: scale(1.02);
            z-index: 2;
            border: none;
        }

        .day-cell.birthday {
            background: var(--gold-gradient);
            color: white !important;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4);
            border: 2px solid white;
            z-index: 3;
        }

        .day-cell.anniversary {
            background: var(--romance-gradient);
            color: white !important;
            box-shadow: 0 4px 12px rgba(190, 24, 93, 0.4);
            border: 2px solid white;
            z-index: 3;
        }

        .date-wrapper {
            position: relative;
            display: inline-block;
            line-height: 1;
        }

        .cuti-dot {
            position: absolute;
            bottom: 2px;
            right: -6px;
            width: 5px;
            height: 5px;
            background-color: #ef4444;
            border-radius: 50%;
            z-index: 10;
        }

        .obs-dot {
            position: absolute;
            bottom: 2px;
            left: -6px;
            width: 5px;
            height: 5px;
            background-color: #3b82f6;
            border-radius: 50%;
            z-index: 10;
        }
        
        .day-cell .pasaran-text {
            font-size: 0.5rem;
            font-weight: 500;
            opacity: 0.6;
            margin-top: 4px;
        }

        .day-cell.highlight-animate {
            animation: highlightPulse 1s ease-out;
            background: #3b82f6 !important;
            color: white !important;
        }
        @keyframes highlightPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .day-cell.sunday, .day-cell.holiday { color: #ef4444; }
        .day-cell.friday { color: #059669; }

        .hidden-element { display: none !important; }

        .hijri-text {
            font-size: 0.5rem;
            position: absolute;
            top: 4px;
            right: 5px; 
            left: auto;
            opacity: 0.5;
            font-weight: 400;
        }

        .holiday-item, .observance-item, .birthday-item, .anniversary-item {
            padding: 0.85rem 1rem;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 0.5rem;
        }

        .holiday-item { border-left: 4px solid #ef4444; }
        .observance-item { border-left: 4px solid #3b82f6; }
        .birthday-item { border-left: 4px solid #d97706; background: #fffbeb; }
        .anniversary-item { border-left: 4px solid #be185d; background: #fdf2f8; }

        .quote-minimalist {
            margin-top: 2.5rem;
            text-align: center;
            padding: 0 1.5rem;
        }

        .quote-text {
            font-size: 0.9rem;
            color: #64748b;
            font-style: italic;
            line-height: 1.6;
            font-weight: 400;
        }

        .footer-rhadzor {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 1px solid #e2e8f0;
            gap: 0.75rem;
            z-index: 10;
        }

        .rhadzor-logo {
            width: 28px;
            height: 28px;
            background: var(--premium-gradient);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 0.9rem;
        }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: flex-end;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active { 
            display: flex; 
            opacity: 1;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 448px;
            border-top-left-radius: 28px;
            border-top-right-radius: 28px;
            padding: 1.5rem;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .modal-content { transform: translateY(0); }

        .scroller-wrapper {
            position: relative;
            height: 220px;
            overflow: hidden;
            mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            margin: 1rem 0;
            display: flex;
        }

        .scroller-col {
            flex: 1;
            height: 100%;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 85px 0;
            scrollbar-width: none;
            text-align: center;
            scroll-snap-type: y mandatory;
        }
        .scroller-col::-webkit-scrollbar { display: none; }

        .scroller-item {
            padding: 10px;
            font-size: 1.1rem;
            font-weight: 500;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.5;
            scroll-snap-align: center;
        }

        .scroller-item.active {
            font-size: 1.5rem;
            font-weight: 800;
            color: #0f172a;
            transform: scale(1.1);
            opacity: 1;
        }

        .selection-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 50px;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            pointer-events: none;
            z-index: -1;
            background: #f8fafc;
        }

        .modal-header-line {
            width: 48px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 99px;
            margin: 0 auto 1.5rem auto;
        }
        
        .toggle-switch {
            appearance: none;
            width: 44px;
            height: 24px;
            background: #cbd5e1;
            border-radius: 99px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .toggle-switch:checked { background: #3b82f6; }
        .toggle-switch:checked::after { transform: translateX(20px); }

        /* Custom Selector Style */
        .premium-select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1rem;
        }
    </style>
</head>
<body>

<div class="app-container">
    <header class="header-rhadzor">
        <div class="header-left">
            <div class="btn-setting" onclick="openSettings()">
                <i class="fas fa-cog"></i>
            </div>
        </div>

        <div class="header-center">
            <div class="nav-row-compact">
                <div class="nav-arrow" onclick="changeMonth(-1)">
                    <i class="fas fa-chevron-left"></i>
                </div>
                
                <div class="month-year-title">
                    <span class="unit-wrapper" id="monthLabel" onclick="openMonthSelector()">JANUARI</span>
                    <span class="unit-wrapper" id="yearLabel" onclick="openYearSelector()">2026</span>
                </div>

                <div class="nav-arrow" onclick="changeMonth(1)">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            <div class="hijri-label" id="hijriRange">RAJAB - SYA'BAN</div>
        </div>
        
        <div class="header-right">
            <div class="btn-today-icon" onclick="goToToday()">
                <i class="fas fa-calendar-day text-sm"></i>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="calendar-card" id="swipeArea">
            <div class="calendar-grid-container" id="gridContainer">
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>
        <div class="space-y-2" id="holidayContainer"></div>
        <div class="quote-minimalist">
            <p class="quote-text" id="quoteDisplay"></p>
        </div>
    </main>

    <div id="searchBtn" class="btn-floating-search">
        <i class="fas fa-search"></i>
    </div>

    <footer class="footer-rhadzor">
        <div class="rhadzor-logo">R</div>
        <span class="text-xs font-black tracking-[0.2em] text-slate-800 uppercase">RHADZOR</span>
    </footer>
</div>

<div class="modal-overlay" id="selectorModal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header-line"></div>
        <h3 id="modalTitle" class="text-center font-bold text-slate-800 mb-2 uppercase text-xs tracking-widest hidden">JUDUL MODAL</h3>
        <div id="modalBodyWrapper" class="flex-1 overflow-hidden flex flex-col">
            <div id="modalBody" class="w-full"></div>
        </div>
    </div>
</div>

<script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
        const swContent = `
            const CACHE_NAME = 'rhadzor-cal-v10';
            const ASSETS = [
                '${window.location.href}',
                'https://cdn.tailwindcss.com',
                'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap',
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
            ];
            self.addEventListener('install', e => {
                e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(ASSETS)));
                self.skipWaiting();
            });
            self.addEventListener('activate', e => e.waitUntil(caches.keys().then(keys => Promise.all(keys.filter(k => k !== CACHE_NAME).map(k => caches.delete(k))))));
            self.addEventListener('fetch', e => {
                e.respondWith(caches.match(e.request).then(res => res || fetch(e.request).catch(() => caches.match('${window.location.href}'))));
            });
        `;
        const blob = new Blob([swContent], { type: 'text/javascript' });
        const swUrl = URL.createObjectURL(blob);
        navigator.serviceWorker.register(swUrl).catch(err => console.log("SW Reg Error:", err));
    }

    const quotes = [
        "Semakin kita mencari kebahagiaan, semakin jauh ia menghilang.", "Kegagalan terbesar adalah tidak pernah mencoba.", "Kata-kata terlembut bisa melukai paling dalam.", "Kita belajar paling banyak dari orang yang paling kita benci.", "Diam terkadang lebih berisik daripada teriakan.", "Kehilangan mengajarkan kita nilai memiliki.", "Kesendirian ramai, keramaian bisa sangat sunyi.", "Menerima adalah cara terkuat untuk melawan.", "Kita paling kuat saat mengakui kelemahan.", "Berubah adalah satu-satunya yang tetap.", "Makin banyak tahu, makin sadar tak tahu apa-apa.", "Waktu sembuhkan luka, waktu juga ciptakan luka.", "Cinta membebaskan dengan cara mengikat.", "Kesederhanaan butuh usaha yang rumit.", "Memberi adalah cara terbaik menerima.", "Memaafkan membebaskan yang memaafkan.", "Ketakutan terbesar adalah takut itu sendiri.", "Kontrol dimulai dari melepas kontrol.", "Kematian memberi arti pada kehidupan.", "Harapan bisa menjadi belenggu tersendiri.", "Kebenaran menyakitkan lebih baik dari kebohongan manis.", "Kesalahan masa lalu adalah guru terbaik hari ini.", "Semakin keras kita pegang, semakin mudah lepas.", "Pertanyaan lebih berharga daripada jawaban.", "Kegelapan mengajarkan kita menghargai cahaya.", "Kepastian adalah ilusi yang nyaman.", "Kita paling hidup saat hampir mati.", "Mendengar lebih sulit daripada berbicara.", "Kesuksesan dimulai dari kegagalan berulang.", "Kehilangan jalan adalah cara menemukan jalan baru.", "Keraguan adalah awal dari kebijaksanaan.", "Melambat terkadang cara tercepat sampai tujuan.", "Rasa sakit mengingatkan kita bahwa kita hidup.", "Mengenal diri sendiri adalah perjalanan seumur hidup.", "Kebahagiaan sejati datang dari dalam, bukan luar.", "Waktu tidak bisa dibeli tapi sering kita sia-siakan.", "Masalah terbesar sering punya solusi tercepat.", "Kehilangan adalah bagian dari memiliki.", "Kesempurnaan adalah musuh dari kemajuan.", "Kita tumbuh paling cepat di luar zona nyaman.", "Yang kita takuti sering tidak pernah terjadi.", "Kebencian meracuni yang membenci.", "Berhenti adalah langkah maju terkadang.", "Mimpi tanpa aksi hanya angan-angan.", "Ketenangan lahir dari menerima kekacauan.", "Perpisahan mengajarkan arti kebersamaan.", "Kekuatan sejati adalah kelembutan.", "Hidup dimulai di ujung zona nyaman.", "Kesabaran adalah kekuatan yang tersembunyi.", "Melepas adalah bentuk kepemilikan tertinggi."
    ];

    const familyBirthdays = [
        { name: "Rhadzor", day: 28, month: 5, year: 1986 },
        { name: "Lisa Istri Tercinta ‚ù§Ô∏è‚ù§Ô∏è", day: 22, month: 6, year: 1988 },
        { name: "Alby", day: 3, month: 8, year: 2013 },
        { name: "Meka", day: 2, month: 3, year: 2020 },
        { name: "Sansa", day: 21, month: 3, year: 2022 }
    ];

    const weddingAnniversary = { day: 23, month: 11, year: 2012 };

    const holidaysData = {
        2025: {
            0: { 1: "Tahun Baru 2025 Masehi", 27: "Isra Mikraj Nabi Muhammad SAW", 29: "Tahun Baru Imlek 2576 Kongzili" },
            2: { 29: "Hari Suci Nyepi (Tahun Baru Saka 1947)", 31: "Idul Fitri 1446 Hijriah" },
            3: { 1: "Idul Fitri 1446 Hijriah", 18: "Wafat Yesus Kristus", 20: "Kebangkitan Yesus Kristus (Paskah)" },
            4: { 1: "Hari Buruh Internasional", 12: "Hari Raya Waisak 2569 BE", 29: "Kenaikan Yesus Kristus" },
            5: { 1: "Hari Lahir Pancasila", 6: "Idul Adha 1446 Hijriah", 27: "1 Muharam Tahun Baru Islam 1447 Hijriah" },
            7: { 17: "Proklamasi Kemerdekaan RI" },
            8: { 5: "Maulid Nabi Muhammad SAW" },
            11: { 25: "Kelahiran Yesus Kristus (Natal)" }
        },
        2026: {
            0: { 1: "Tahun Baru 2026 Masehi", 16: "Isra Mikraj Nabi Muhammad SAW" },
            1: { 17: "Tahun Baru Imlek 2577 Kongzili" },
            2: { 19: "Hari Suci Nyepi (Tahun Baru Saka 1948)", 21: "Idul Fitri 1447 Hijriah", 22: "Idul Fitri 1447 Hijriah" },
            3: { 3: "Wafat Yesus Kristus", 5: "Kebangkitan Yesus Kristus (Paskah)" },
            4: { 1: "Hari Buruh Internasional", 14: "Kenaikan Yesus Kristus", 27: "Idul Adha 1447 Hijriah", 31: "Hari Raya Waisak 2570 BE" },
            5: { 1: "Hari Lahir Pancasila", 16: "1 Muharam Tahun Baru Islam 1448 Hijriah" },
            7: { 17: "Proklamasi Kemerdekaan RI", 25: "Maulid Nabi Muhammad SAW" },
            11: { 25: "Kelahiran Yesus Kristus (Natal)" }
        }
    };

    const cutiBersamaData = {
        2025: {
            0: { 28: "Cuti Bersama Imlek 2576" },
            2: { 28: "Cuti Bersama Nyepi Saka 1947" },
            3: { 2: "Cuti Bersama Idul Fitri", 3: "Cuti Bersama Idul Fitri", 4: "Cuti Bersama Idul Fitri", 7: "Cuti Bersama Idul Fitri" },
            4: { 13: "Cuti Bersama Waisak", 30: "Cuti Bersama Kenaikan Yesus Kristus" },
            5: { 9: "Cuti Bersama Idul Adha" },
            7: { 18: "Cuti Bersama Proklamasi Kemerdekaan" },
            11: { 26: "Cuti Bersama Natal" }
        },
        2026: {
            1: { 16: "Cuti Bersama Imlek 2577" },
            2: { 18: "Cuti Bersama Nyepi Saka 1948", 20: "Cuti Bersama Idul Fitri", 23: "Cuti Bersama Idul Fitri", 24: "Cuti Bersama Idul Fitri" },
            4: { 15: "Cuti Bersama Kenaikan Yesus Kristus", 28: "Cuti Bersama Idul Adha" },
            11: { 24: "Cuti Bersama Natal" }
        }
    };

    const nationalObservances = {
        0: { 3: "Hari Amal Bhakti Kemenag RI", 5: "Hari KOWAL", 10: "Hari Tritura", 15: "Hari Dharma Samudera", 17: "Hari Raya Siwaratri", 23: "Hari Patriotik", 25: "Hari Gizi Nasional", 31: "Hari Lahir NU" },
        1: { 5: "Peristiwa Kapal Tujuh", 9: "Hari Pers Nasional (HPN)", 14: "Peringatan PETA", 21: "Hari Peduli Sampah Nasional", 28: "Hari Gizi Nasional" },
        2: { 1: "Serangan Umum 1 Maret", 9: "Hari Musik Nasional", 30: "Hari Film Nasional" },
        3: { 6: "Hari Nelayan Indonesia", 9: "Hari TNI AU", 16: "Hari Kopassus", 21: "Hari Kartini", 27: "Hari Pemasyarakatan", 28: "Hari Puisi Nasional" },
        4: { 2: "Hardiknas", 17: "Hari Buku Nasional", 20: "Hari Kebangkitan Nasional", 29: "Hari Lanjut Usia Nasional" },
        5: { 21: "Hari Krida Pertanian", 24: "Hari Bidan Nasional", 29: "Hari KB" },
        6: { 1: "Hari Bhayangkara", 5: "Hari Bank Indonesia", 12: "Hari Koperasi Indonesia", 22: "Hari Kejaksaan", 23: "Hari Anak Nasional" },
        7: { 5: "Hari Dharma Wanita", 10: "Hari Veteran Nasional", 14: "Hari Pramuka", 21: "Hari Maritim Nasional", 24: "Hari TVRI" },
        8: { 1: "Hari Polwan", 3: "Hari PMI", 4: "Hari Pelanggan Nasional", 9: "Hari Olahraga Nasional", 17: "Hari Perhubungan Nasional", 24: "Hari Tani Nasional", 28: "Hari Kereta Api", 30: "Peringatan G30S/PKI" },
        9: { 1: "Hari Kesaktian Pancasila", 2: "Hari Batik Nasional", 5: "Hari TNI", 24: "Hari Dokter Indonesia", 27: "Hari Listrik Nasional", 28: "Hari Sumpah Pemuda", 30: "Hari Keuangan Nasional" },
        10: { 5: "Hari Cinta Puspa & Satwa", 10: "Hari Pahlawan", 12: "Hari Kesehatan / Hari Ayah", 14: "Hari Brimob", 25: "Hari Guru", 28: "Hari Menanam Pohon", 29: "Hari KORPRI" },
        11: { 12: "Hari Transmigrasi", 13: "Hari Nusantara", 19: "Hari Bela Negara", 22: "Hari Ibu" }
    };

    const hijriMonths = ["MUHARRAM", "SAFAR", "RABIUL AWAL", "RABIUL AKHIR", "JUMADIL AWAL", "JUMADIL AKHIR", "RAJAB", "SYA'BAN", "RAMADHAN", "SYAWAL", "DZULQA'DAH", "DZULHIJJAH"];
    const pasaranArr = ["LEGI", "PAHING", "PON", "WAGE", "KLIWON"];
    const monthNames = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
    const dayNames = ["MINGGU", "SENIN", "SELASA", "RABU", "KAMIS", "JUMAT", "SABTU"];
    const dayShortNames = ["MGG", "SEN", "SEL", "RAB", "KAM", "JUM", "SAB"];

    let currentDate = new Date();
    let isAnimating = false;
    let settings = { 
        showHijri: true, 
        showPasaran: true, 
        showObservances: true, 
        showFamily: true,
        transitionType: 'slide' // Default transition
    };

    function init() {
        renderCalendar();
        updateQuote();
        setupSwipe();
        setupDrag();
    }

    function setupDrag() {
        const btn = document.getElementById('searchBtn');
        let offsetX, offsetY, startTime;
        let isMoving = false;

        const start = (e) => {
            const point = e.type.includes('touch') ? e.touches[0] : e;
            const rect = btn.getBoundingClientRect();
            offsetX = point.clientX - rect.left;
            offsetY = point.clientY - rect.top;
            startTime = Date.now();
            isMoving = false;
            
            if (!e.type.includes('touch')) {
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', end);
            }
        };

        const move = (e) => {
            const point = e.type.includes('touch') ? e.touches[0] : e;
            isMoving = true;
            let x = point.clientX - offsetX;
            let y = point.clientY - offsetY;
            
            const maxX = window.innerWidth - btn.offsetWidth;
            const maxY = window.innerHeight - btn.offsetHeight;
            x = Math.min(Math.max(0, x), maxX);
            y = Math.min(Math.max(0, y), maxY);
            
            btn.style.left = x + 'px';
            btn.style.top = y + 'px';
            btn.style.bottom = 'auto';
            btn.style.right = 'auto';
        };

        const end = () => {
            const duration = Date.now() - startTime;
            if (!isMoving || duration < 200) {
                openDateSearch();
            }
            document.removeEventListener('mousemove', move);
            document.removeEventListener('mouseup', end);
        };

        btn.addEventListener('touchstart', start, { passive: true });
        btn.addEventListener('touchmove', move, { passive: true });
        btn.addEventListener('touchend', end, { passive: true });
        btn.addEventListener('mousedown', start);
    }

    function getHijriDate(date) {
        let julian = Math.floor((date.getTime() / 86400000) + 2440587.5);
        let l = julian - 1948440 + 10632;
        let n = Math.floor((l - 1) / 10631);
        l = l - 10631 * n + 354;
        let j = (Math.floor((10985 - l) / 5316)) * (Math.floor((50 * l) / 17719)) + (Math.floor(l / 5670)) * (Math.floor((43 * l) / 15238));
        l = l - (Math.floor((30 - j) / 15)) * (Math.floor((17719 * j) / 50)) - (Math.floor(j / 16)) * (Math.floor((15238 * j) / 43)) + 29;
        let m = Math.floor((24 * l) / 709);
        let d = l - Math.floor((709 * m) / 24);
        let y = 30 * n + j - 30;
        
        // Accurate sync for 21 March 2026
        if (date.getFullYear() === 2026 && date.getMonth() === 2 && date.getDate() === 21) {
            return { day: 1, month: 9, year: y }; 
        }
        
        return { day: d, month: m - 1, year: y };
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const now = new Date();
        const isCurrentMonthYear = (now.getFullYear() === year && now.getMonth() === month);
        const todayDayNum = now.getDate();
        
        document.getElementById('monthLabel').textContent = monthNames[month];
        document.getElementById('yearLabel').textContent = year;
        
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        
        dayShortNames.forEach(d => {
            const el = document.createElement('div');
            el.className = 'day-label';
            el.textContent = d;
            grid.appendChild(el);
        });
        
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        const startH = getHijriDate(new Date(year, month, 1));
        const endH = getHijriDate(new Date(year, month, daysInMonth));
        const hijriLabelEl = document.getElementById('hijriRange');
        hijriLabelEl.textContent = `${hijriMonths[startH.month]} - ${hijriMonths[endH.month]}`;
        hijriLabelEl.style.display = settings.showHijri ? 'block' : 'none';

        for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div'));
        
        for (let d = 1; d <= daysInMonth; d++) {
            const dateObj = new Date(year, month, d);
            const isToday = isCurrentMonthYear && d === todayDayNum;
            const h = getHijriDate(dateObj);
            
            const refDate = new Date(2026, 0, 1);
            const diff = Math.floor((dateObj - refDate) / 86400000);
            const pasaranIdx = (3 + (diff % 5) + 5) % 5;
            
            const holidayName = holidaysData[year]?.[month]?.[d];
            const cutiName = cutiBersamaData[year]?.[month]?.[d];
            const observanceName = settings.showObservances ? nationalObservances[month]?.[d] : null;
            const bday = settings.showFamily ? familyBirthdays.find(b => b.day === d && b.month === month) : null;
            const isAnniv = settings.showFamily && weddingAnniversary.day === d && weddingAnniversary.month === month;
            
            const cell = document.createElement('div');
            let cellClass = `day-cell ${isToday ? 'today' : ''}`;
            if (isAnniv) cellClass += ' anniversary';
            else if (bday) cellClass += ' birthday';
            else if (dateObj.getDay() === 0 || holidayName) cellClass += ' sunday';
            else if (dateObj.getDay() === 5) cellClass += ' friday';
            
            cell.className = cellClass;
            if (isToday) cell.id = 'currentDayCell';

            cell.innerHTML = `
                <span class="hijri-text ${settings.showHijri ? '' : 'hidden-element'}">${h.day}</span>
                <span class="date-wrapper">${d}${cutiName ? '<div class="cuti-dot"></div>' : ''}${observanceName ? '<div class="obs-dot"></div>' : ''}</span>
                <span class="pasaran-text ${settings.showPasaran ? '' : 'hidden-element'}">${pasaranArr[pasaranIdx]}</span>
            `;
            
            cell.onclick = () => showDetail(d, month, year, dayNames[dateObj.getDay()], pasaranArr[pasaranIdx], h.day, hijriMonths[h.month], holidayName, cutiName, observanceName, dateObj.getDay() === 0, bday, isAnniv);
            grid.appendChild(cell);
        }
        renderEventsList(month, year);
    }

    function renderEventsList(month, year) {
        const container = document.getElementById('holidayContainer');
        container.innerHTML = '';
        
        if (settings.showFamily && weddingAnniversary.month === month) {
            const age = year - weddingAnniversary.year;
            const div = document.createElement('div');
            div.className = 'anniversary-item flex justify-between items-center';
            div.innerHTML = `<div class="flex flex-col"><span class="text-[0.7rem] font-bold text-pink-800">${weddingAnniversary.day} ${monthNames[month]}</span><span class="text-[0.6rem] text-pink-600 font-semibold">Anniversary Pernikahan ‚ù§Ô∏è</span></div><span class="text-[0.65rem] font-bold text-pink-700 bg-pink-100 px-2 py-1 rounded-full">Ke-${age}</span>`;
            container.appendChild(div);
        }

        if (settings.showFamily) {
            familyBirthdays.filter(b => b.month === month).sort((a,b) => a.day - b.day).forEach(b => {
                const div = document.createElement('div');
                div.className = 'birthday-item flex justify-between items-center';
                div.innerHTML = `<div class="flex flex-col"><span class="text-[0.7rem] font-bold text-amber-800">${b.day} ${monthNames[month]}</span><span class="text-[0.6rem] text-amber-600 font-semibold">Ulang Tahun ${b.name}</span></div><span class="text-[0.65rem] font-bold text-amber-700 bg-amber-100 px-2 py-1 rounded-full">Ke-${year - b.year}</span>`;
                container.appendChild(div);
            });
        }

        let events = [];
        if (holidaysData[year]?.[month]) Object.keys(holidaysData[year][month]).forEach(d => events.push({ d, n: holidaysData[year][month][d], t: 'h' }));
        if (cutiBersamaData[year]?.[month]) Object.keys(cutiBersamaData[year][month]).forEach(d => events.push({ d, n: cutiBersamaData[year][month][d], t: 'c' }));
        if (settings.showObservances && nationalObservances[month]) Object.keys(nationalObservances[month]).forEach(d => events.push({ d, n: nationalObservances[month][d], t: 'o' }));

        events.sort((a,b) => a.d - b.d).forEach(e => {
            const div = document.createElement('div');
            div.className = e.t === 'o' ? 'observance-item flex justify-between items-center' : 'holiday-item flex justify-between items-center';
            div.innerHTML = `<span class="text-[0.7rem] font-bold text-slate-800">${e.d} ${monthNames[month]}</span><span class="text-[0.65rem] ${e.t === 'o' ? 'text-blue-600' : 'text-red-600'} font-medium text-right">${e.n}</span>`;
            container.appendChild(div);
        });
    }

    function goToToday() {
        currentDate = new Date();
        renderCalendar();
        setTimeout(() => {
            const todayCell = document.getElementById('currentDayCell');
            if (todayCell) {
                todayCell.classList.add('highlight-animate');
                setTimeout(() => todayCell.classList.remove('highlight-animate'), 1000);
            }
        }, 50);
    }

    function updateQuote() {
        const idx = Math.floor(Math.random() * quotes.length);
        document.getElementById('quoteDisplay').textContent = `"${quotes[idx]}"`;
    }

    /* MULTI-TRANSITION SYSTEM */
    function changeMonth(dir) {
        if (isAnimating) return;
        isAnimating = true;
        const container = document.getElementById('gridContainer');
        const type = settings.transitionType;
        
        const applyTransitionOut = () => {
            container.style.opacity = '0';
            switch(type) {
                case 'slide':
                    container.style.transform = dir > 0 ? 'translateX(-15%)' : 'translateX(15%)';
                    break;
                case 'cube':
                    container.style.transformOrigin = dir > 0 ? 'left center' : 'right center';
                    container.style.transform = dir > 0 ? 'rotateY(-90deg) scale(0.85) translateZ(50px)' : 'rotateY(90deg) scale(0.85) translateZ(50px)';
                    break;
                case 'zoom':
                    container.style.transform = 'scale(0.8)';
                    break;
                case 'flip':
                    container.style.transform = 'rotateY(180deg)';
                    break;
                case 'fade':
                    // Default opacity is enough
                    break;
            }
        };

        const applyTransitionIn = () => {
            container.style.transition = 'none';
            switch(type) {
                case 'slide':
                    container.style.transform = dir > 0 ? 'translateX(15%)' : 'translateX(-15%)';
                    break;
                case 'cube':
                    container.style.transformOrigin = dir > 0 ? 'right center' : 'left center';
                    container.style.transform = dir > 0 ? 'rotateY(90deg) scale(0.85) translateZ(50px)' : 'rotateY(-90deg) scale(0.85) translateZ(50px)';
                    break;
                case 'zoom':
                    container.style.transform = 'scale(1.2)';
                    break;
                case 'flip':
                    container.style.transform = 'rotateY(-180deg)';
                    break;
            }
        };

        const resetTransition = () => {
            const duration = type === 'cube' || type === 'flip' ? '0.5s' : '0.4s';
            const easing = type === 'cube' ? 'cubic-bezier(0.175, 0.885, 0.32, 1.275)' : 'cubic-bezier(0.4, 0, 0.2, 1)';
            container.style.transition = `transform ${duration} ${easing}, opacity 0.3s`;
            container.style.transform = 'translateX(0) rotateY(0deg) scale(1) translateZ(0)';
            container.style.opacity = '1';
        };

        applyTransitionOut();
        
        setTimeout(() => {
            currentDate.setDate(1);
            currentDate.setMonth(currentDate.getMonth() + dir);
            renderCalendar();
            updateQuote();
            
            applyTransitionIn();
            
            setTimeout(() => {
                resetTransition();
                setTimeout(() => isAnimating = false, 500);
            }, 50);
        }, 250);
    }

    function openSettings() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden');
        title.textContent = "PENGATURAN";
        body.className = "p-4 space-y-4";
        
        const toggles = [
            { id: 'showPasaran', label: 'Tampilkan Tanggal Jawa' },
            { id: 'showHijri', label: 'Tampilkan Tanggal Hijriah' },
            { id: 'showObservances', label: 'Tampilkan Hari Peringatan' },
            { id: 'showFamily', label: 'Tampilkan Hari Keluarga' }
        ];

        let html = toggles.map(o => `
            <div class="flex justify-between items-center p-2 bg-slate-50 rounded-xl">
                <span class="font-bold text-sm text-slate-700">${o.label}</span>
                <input type="checkbox" class="toggle-switch" ${settings[o.id] ? 'checked' : ''} onchange="toggleSetting('${o.id}')">
            </div>
        `).join('');

        // Transition Selector
        html += `
            <div class="pt-2">
                <span class="block font-bold text-[0.65rem] text-slate-400 uppercase tracking-widest mb-2 px-1">Efek Transisi Bulan</span>
                <select class="premium-select" onchange="settings.transitionType = this.value">
                    <option value="slide" ${settings.transitionType === 'slide' ? 'selected' : ''}>Slide (Klasik)</option>
                    <option value="cube" ${settings.transitionType === 'cube' ? 'selected' : ''}>Cube Flip (3D)</option>
                    <option value="fade" ${settings.transitionType === 'fade' ? 'selected' : ''}>Fade (Lembut)</option>
                    <option value="zoom" ${settings.transitionType === 'zoom' ? 'selected' : ''}>Zoom In/Out</option>
                    <option value="flip" ${settings.transitionType === 'flip' ? 'selected' : ''}>Flip Card</option>
                </select>
            </div>
        `;

        body.innerHTML = html;
        openModal();
    }

    function toggleSetting(key) {
        settings[key] = !settings[key];
        renderCalendar();
    }

    function openMonthSelector() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden');
        title.textContent = "PILIH BULAN";
        body.className = "grid grid-cols-3 gap-3 p-2";
        body.innerHTML = monthNames.map((m, i) => `
            <div onclick="currentDate.setMonth(${i}); renderCalendar(); closeModal();" class="p-3 text-center rounded-xl font-bold text-[0.75rem] cursor-pointer transition ${currentDate.getMonth() === i ? 'bg-slate-900 text-white shadow-lg' : 'bg-slate-50 text-slate-600 hover:bg-slate-100'}">${m}</div>
        `).join('');
        openModal();
    }

    function openYearSelector() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden');
        title.textContent = "PILIH TAHUN";
        body.className = "w-full";
        const curY = currentDate.getFullYear();
        body.innerHTML = `
            <div class="scroller-wrapper"><div class="selection-indicator"></div><div class="scroller-col" id="yearListScroll"></div></div>
            <button onclick="selectHighlightedYear()" class="w-full mt-4 bg-slate-900 text-white p-3 rounded-xl font-bold text-xs tracking-wider">PILIH TAHUN INI</button>
        `;
        const list = document.getElementById('yearListScroll');
        for(let y = curY - 50; y <= curY + 50; y++) {
            const item = document.createElement('div');
            item.className = `scroller-item ${y === curY ? 'active' : ''}`;
            item.textContent = y; item.dataset.value = y;
            list.appendChild(item);
        }
        openModal();
        setupScrollSnapObserver('yearListScroll');
        setTimeout(() => {
            const active = list.querySelector('.active');
            if(active) active.scrollIntoView({ block: 'center' });
        }, 100);
    }

    function selectHighlightedYear() {
        const activeEl = document.querySelector('#yearListScroll .active');
        if(activeEl) { currentDate.setFullYear(parseInt(activeEl.dataset.value)); renderCalendar(); closeModal(); }
    }

    function openDateSearch() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden');
        title.textContent = "CARI BULAN & TAHUN";
        body.className = "w-full";
        const curM = currentDate.getMonth();
        const curY = currentDate.getFullYear();
        body.innerHTML = `
            <div class="scroller-wrapper"><div class="selection-indicator"></div><div class="scroller-col" id="monthScroller"></div><div class="scroller-col" id="yearScroller"></div></div>
            <button onclick="jumpToSelected()" class="w-full mt-4 bg-slate-900 text-white p-3 rounded-xl font-bold text-xs tracking-wider">LIHAT KALENDER</button>
        `;
        const mList = document.getElementById('monthScroller');
        const yList = document.getElementById('yearScroller');
        monthNames.forEach((m, i) => {
            const item = document.createElement('div');
            item.className = `scroller-item ${i === curM ? 'active' : ''}`;
            item.textContent = m; item.dataset.value = i;
            mList.appendChild(item);
        });
        for(let y = curY - 30; y <= curY + 30; y++) {
            const item = document.createElement('div');
            item.className = `scroller-item ${y === curY ? 'active' : ''}`;
            item.textContent = y; item.dataset.value = y;
            yList.appendChild(item);
        }
        openModal();
        setupScrollSnapObserver('monthScroller');
        setupScrollSnapObserver('yearScroller');
        setTimeout(() => {
            const am = mList.querySelector('.active'); const ay = yList.querySelector('.active');
            if(am) am.scrollIntoView({ block: 'center' });
            if(ay) ay.scrollIntoView({ block: 'center' });
        }, 100);
    }

    function jumpToSelected() {
        const am = document.querySelector('#monthScroller .active');
        const ay = document.querySelector('#yearScroller .active');
        if(am && ay) { currentDate.setDate(1); currentDate.setMonth(parseInt(am.dataset.value)); currentDate.setFullYear(parseInt(ay.dataset.value)); renderCalendar(); updateQuote(); closeModal(); }
    }

    function setupScrollSnapObserver(id) {
        const container = document.getElementById(id);
        let timeout;
        container.onscroll = () => {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                const center = container.scrollTop + (container.clientHeight / 2);
                const items = container.querySelectorAll('.scroller-item');
                let closest = null; let minDiff = Infinity;
                items.forEach(item => {
                    const diff = Math.abs(center - (item.offsetTop + (item.offsetHeight/2)));
                    if (diff < minDiff) { minDiff = diff; closest = item; }
                    item.classList.remove('active');
                });
                if (closest) closest.classList.add('active');
            }, 50);
        };
    }

    function showDetail(d, m, y, dayName, pasaran, hDate, hMonth, holiday, cuti, obs, isSun, bday, anniv) {
        const body = document.getElementById('modalBody');
        document.getElementById('modalTitle').classList.add('hidden');
        body.className = "p-4 text-center";
        
        let color = (isSun || holiday) ? "text-red-600" : "text-slate-900";
        if (bday) color = "text-amber-600"; else if (anniv) color = "text-pink-600";

        let badges = '';
        if (holiday) badges += `<div class="mt-2 px-3 py-1 bg-red-100 text-red-600 rounded-full font-bold text-[0.65rem] border border-red-200 inline-block m-1">${holiday}</div>`;
        if (cuti) badges += `<div class="mt-2 px-3 py-1 bg-red-50 text-red-500 rounded-full font-bold text-[0.65rem] border border-red-200 inline-block m-1">${cuti}</div>`;
        if (obs) badges += `<div class="mt-2 px-3 py-1 bg-blue-50 text-blue-500 rounded-full font-bold text-[0.65rem] border border-blue-200 inline-block m-1">${obs}</div>`;
        if (bday) badges += `<div class="mt-2 px-3 py-1 bg-amber-100 text-amber-700 rounded-full font-bold text-[0.65rem] border border-amber-200 inline-block m-1">üéâ ULTAH ${bday.name}</div>`;
        if (anniv) badges += `<div class="mt-2 px-3 py-1 bg-pink-100 text-pink-700 rounded-full font-bold text-[0.65rem] border border-pink-200 inline-block m-1">üíç ANNIVERSARY</div>`;

        body.innerHTML = `
            <div class="flex flex-col items-center mb-6">
                <div class="text-6xl font-black ${color} tracking-tighter">${d}</div>
                <div class="text-xs font-bold uppercase mt-1 tracking-widest text-slate-400">${monthNames[m]} ${y}</div>
                ${badges}
            </div>
            <div class="bg-white border border-slate-100 rounded-3xl p-4 shadow-sm mb-5">
                <div class="text-xl font-black text-slate-800 uppercase">${dayName} ${settings.showPasaran ? pasaran : ''}</div>
                <div class="text-sm font-medium text-slate-500 mt-1">${settings.showHijri ? hDate+' '+hMonth+' 1447H' : ''}</div> 
            </div>
            <div class="p-5 bg-slate-50 rounded-3xl border border-slate-100">
                <p class="text-sm italic text-slate-600 leading-relaxed font-medium">"${quotes[Math.floor(Math.random() * quotes.length)]}"</p>
            </div>
        `;
        openModal();
    }

    function openModal() { document.getElementById('selectorModal').classList.add('active'); }
    function closeModal() { document.getElementById('selectorModal').classList.remove('active'); }

    function setupSwipe() {
        let sx = 0;
        const area = document.getElementById('swipeArea');
        area.addEventListener('touchstart', e => sx = e.changedTouches[0].screenX, { passive: true });
        area.addEventListener('touchend', e => {
            const ex = e.changedTouches[0].screenX;
            if (ex < sx - 60) changeMonth(1);
            if (ex > sx + 60) changeMonth(-1);
        }, { passive: true });
    }

    window.onload = init;
</script>
</body>
</html>
