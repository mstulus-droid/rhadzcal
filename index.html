<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RhadzCal v10 - Final Adaptive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'lg': '1024px',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            /* Default Theme (Royal) */
            --bg-color: #cbd5e1;
            --card-bg: #f8fafc;
            --premium-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --accent-color: #3b82f6;
            --text-primary: #1e293b;
            --gold-gradient: linear-gradient(135deg, #d97706 0%, #fbbf24 100%);
            --romance-gradient: linear-gradient(135deg, #be185d 0%, #ec4899 100%);
        }

        /* Theme Variations Classes */
        .theme-emerald {
            --bg-color: #d1fae5;
            --premium-gradient: linear-gradient(135deg, #064e3b 0%, #059669 100%);
            --accent-color: #10b981;
        }
        .theme-amethyst {
            --bg-color: #f3e8ff;
            --premium-gradient: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
            --accent-color: #8b5cf6;
        }
        .theme-crimson {
            --bg-color: #ffe4e6;
            --premium-gradient: linear-gradient(135deg, #881337 0%, #e11d48 100%);
            --accent-color: #f43f5e;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            height: 100vh; /* Strict height */
            height: 100dvh; /* Dynamic viewport height for mobile */
            overflow: hidden; /* Prevent body scroll */
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s ease;
        }

        .app-container {
            width: 100%;
            height: 100%;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden; /* Important for preventing layout shifts */
        }

        @media (max-width: 1023px) {
            .app-container {
                max-width: 448px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
            }
            .desktop-sidebar, .desktop-header-controls { display: none; }
            body { align-items: flex-start; }
            
            /* MOBILE LAYOUT STRUCTURE */
            .main-content {
                flex: 1;
                display: flex !important;
                flex-direction: column;
                overflow: hidden !important; 
                padding: 0 !important;
                position: relative;
                min-height: 0; /* Crucial for nested flex scrolling */
            }
            
            .calendar-section-mobile {
                flex-shrink: 0;
                padding: 1rem 1rem 0.5rem 1rem;
                background: #f8fafc;
                z-index: 10;
                box-shadow: 0 4px 10px -5px rgba(0,0,0,0.1);
            }

            .info-section-mobile {
                flex: 1;
                overflow-y: auto;
                padding: 1rem;
                background: #f1f5f9;
                scroll-behavior: smooth;
                /* PADDING BOTTOM DITAMBAH AGAR TIDAK KETUTUP FOOTER */
                padding-bottom: 7rem; 
            }
            
            .footer-rhadzor {
                background: var(--premium-gradient) !important;
                color: white !important;
                border-top: none !important;
                padding: 0.75rem 1.5rem;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
                justify-content: space-between !important;
            }
        }

        @media (min-width: 1024px) {
            body {
                align-items: center;
                background-image: url('https://images.unsplash.com/photo-1497864149936-d466327778cd?q=80&w=2070&auto=format&fit=crop');
                background-size: cover;
                background-position: center;
                backdrop-filter: blur(8px);
            }
            .app-container {
                max-width: 1400px;
                height: 90vh;
                max-height: 900px;
                flex-direction: row;
                border-radius: 24px;
                overflow: hidden;
                box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5);
                background: rgba(255, 255, 255, 0.95);
            }
            .header-rhadzor, .footer-rhadzor { display: none !important; }
            .desktop-sidebar { display: flex !important; }
            .desktop-right-panel { display: flex !important; }
            
            .main-content { padding: 1.5rem 2rem !important; overflow: hidden; background: white; display: block; }
            .calendar-section-mobile { padding: 0; box-shadow: none; background: transparent; height: 100%; display: flex; flex-direction: column; }
            .info-section-mobile { display: none; }
        }

        .header-rhadzor {
            background: var(--premium-gradient);
            padding: 0 1rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 50; /* High Z-Index to stay on top */
            height: 70px;
            flex-shrink: 0;
            position: relative; /* Ensure stacking context */
        }

        .header-left, .header-right { width: 44px; display: flex; justify-content: center; }
        .header-center { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .nav-arrow { padding: 0.5rem; cursor: pointer; opacity: 0.6; transition: 0.2s; }
        .nav-arrow:hover { opacity: 1; }
        .hijri-label { font-size: 0.6rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.6; color: #cbd5e1; }

        .month-year-title {
            display: flex;
            gap: 0.5rem;
            font-size: 1.15rem; 
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        .desktop-sidebar {
            width: 280px;
            background: var(--premium-gradient);
            color: white;
            display: none;
            flex-direction: column;
            padding: 2rem;
            justify-content: space-between;
            box-shadow: 4px 0 24px rgba(0,0,0,0.1);
            z-index: 30;
        }

        .desktop-right-panel {
            width: 320px;
            background: #f1f5f9;
            display: none;
            flex-direction: column;
            padding: 1.5rem;
            border-left: 1px solid #e2e8f0;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            scrollbar-width: none;
        }
        .main-content::-webkit-scrollbar { display: none; }

        .calendar-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 1rem;
            position: relative;
            touch-action: pan-y pinch-zoom;
            box-shadow: 8px 8px 16px rgba(0,0,0,0.05), -8px -8px 16px rgba(255,255,255,0.8);
            perspective: 1200px;
        }

        @media (min-width: 1024px) {
            .calendar-card {
                box-shadow: none;
                background: transparent;
                padding: 0;
                flex: 1; 
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }
            .calendar-grid-container { height: 100%; }
            .calendar-grid { 
                height: 100%; 
                grid-template-rows: 30px repeat(6, 1fr); 
            }
        }

        .calendar-grid-container {
            width: 100%;
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        @media (min-width: 1024px) { .calendar-grid { gap: 8px; } }

        .day-label {
            text-align: center; font-size: 0.7rem; font-weight: 800;
            color: #64748b; padding-bottom: 0.75rem; text-transform: uppercase;
        }
        @media (min-width: 1024px) {
            .day-label { padding-bottom: 0; display: flex; align-items: center; justify-content: center; }
        }

        .day-cell {
            aspect-ratio: 1/1.1;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 14px; font-size: 1.1rem; font-weight: 600;
            position: relative; cursor: pointer; transition: all 0.2s;
            color: #1e293b; border: 1px solid transparent;
        }

        .day-cell.other-month {
            opacity: 0.25;
            transform: scale(0.9);
            font-size: 0.9rem;
            pointer-events: none;
        }

        @media (min-width: 1024px) {
            .day-cell {
                aspect-ratio: auto;
                min-height: 40px; 
                border-radius: 12px;
                background: #f8fafc;
                align-items: center;
                justify-content: center;
                padding: 2px;
            }
            .day-cell .date-wrapper {
                font-size: 1.4rem; 
                font-weight: 700;
                margin-bottom: 1px;
            }
            .day-cell:hover:not(.other-month) { background: #e2e8f0; transform: translateY(-2px); }
            .hijri-text { top: 4px; right: 6px; font-size: 0.6rem !important; }
            .pasaran-text { margin-top: 0; align-self: center; font-size: 0.6rem !important; opacity: 0.7; }
        }
        
        .day-cell.today { background: var(--premium-gradient); color: white !important; box-shadow: 0 8px 16px rgba(0,0,0,0.2); transform: scale(1.02); z-index: 2; border: none; }
        
        @keyframes attractive-pulse {
            0% { box-shadow: 0 0 0 0px rgba(59, 130, 246, 0.4); transform: scale(1.02); }
            50% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); transform: scale(1.1); }
            100% { box-shadow: 0 0 0 0px rgba(59, 130, 246, 0); transform: scale(1.02); }
        }
        .today-jump-animation {
            animation: attractive-pulse 0.8s ease-out 2;
        }

        .day-cell.birthday { background: var(--gold-gradient); color: white !important; box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4); border: 2px solid white; z-index: 3; }
        .day-cell.anniversary { background: var(--romance-gradient); color: white !important; box-shadow: 0 4px 12px rgba(190, 24, 93, 0.4); border: 2px solid white; z-index: 3; }
        .day-cell.sunday, .day-cell.holiday { color: #ef4444; }
        .day-cell.friday { color: #059669; }

        .date-wrapper { position: relative; line-height: 1; }
        .cuti-dot, .obs-dot { position: absolute; width: 5px; height: 5px; border-radius: 50%; z-index: 10; }
        .cuti-dot { bottom: 2px; right: -6px; background-color: #ef4444; }
        .obs-dot { bottom: 2px; left: -6px; background-color: #3b82f6; }
        
        @media (min-width: 1024px) {
            .cuti-dot { bottom: 3px; right: -6px; width: 5px; height: 5px; }
            .obs-dot { bottom: 3px; left: -6px; width: 5px; height: 5px; }
        }
        
        .pasaran-text { font-size: 0.5rem; font-weight: 500; opacity: 0.6; margin-top: 4px; }
        .hijri-text { font-size: 0.5rem; position: absolute; top: 4px; right: 5px; opacity: 0.5; }
        .hidden-element { display: none !important; }

        .holiday-item, .observance-item, .birthday-item, .anniversary-item {
            padding: 0.85rem 1rem; background: #ffffff; border-radius: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 0.5rem; transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .holiday-item { border-left: 4px solid #ef4444; }
        .observance-item { border-left: 4px solid #3b82f6; }
        .birthday-item { background: #fffbeb; border-left: 4px solid #d97706; }
        .anniversary-item { background: #fdf2f8; border-left: 4px solid #be185d; }

        .highlight-today {
            background-color: #fef9c3 !important; 
            box-shadow: 0 4px 6px -1px rgba(250, 204, 21, 0.1), 0 2px 4px -1px rgba(250, 204, 21, 0.06) !important;
            transform: scale(1.02);
            z-index: 5;
            border: 1px solid #fde047;
        }
        
        .event-list-container:empty::before {
            content: 'Tidak ada agenda bulan ini';
            display: block; text-align: center; color: #94a3b8; font-size: 0.8rem; margin-top: 2rem;
        }

        .footer-rhadzor {
            position: absolute; bottom: 0; width: 100%;
            padding: 1rem; display: flex; justify-content: center; align-items: center;
            gap: 0.75rem; z-index: 50; flex-shrink: 0;
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px);
            display: none; z-index: 100; opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.active { display: flex; opacity: 1; }

        @media (max-width: 1023px) {
            .modal-overlay { align-items: flex-end; }
            .modal-content {
                background: white; width: 100%; max-width: 448px; margin: 0 auto;
                border-top-left-radius: 28px; border-top-right-radius: 28px;
                padding: 1.5rem; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
                max-height: 80vh; overflow-y: auto;
            }
            .modal-overlay.active .modal-content { transform: translateY(0); }
        }

        @media (min-width: 1024px) {
            .modal-overlay { align-items: center; justify-content: center; }
            .modal-content {
                background: white; width: 400px; border-radius: 24px; padding: 2rem;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                transform: scale(0.9); transition: transform 0.2s;
            }
            .modal-overlay.active .modal-content { transform: scale(1); }
            .modal-header-line { display: none; }
        }

        .modal-header-line { width: 48px; height: 6px; background: #e2e8f0; border-radius: 99px; margin: 0 auto 1.5rem auto; }
        
        .desktop-header-controls {
            display: none; justify-content: space-between; align-items: center;
            margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e2e8f0;
        }
        @media (min-width: 1024px) { .desktop-header-controls { display: flex; } }

        .toggle-switch {
            appearance: none; width: 40px; height: 22px; background: #cbd5e1;
            border-radius: 99px; position: relative; cursor: pointer; transition: background 0.2s;
        }
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px;
            background: white; border-radius: 50%; transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .toggle-switch:checked { background: var(--accent-color); }
        .toggle-switch:checked::after { transform: translateX(18px); }

        .premium-select {
            width: 100%; padding: 0.75rem 1rem; background: #f1f5f9;
            border: 1px solid #e2e8f0; border-radius: 12px;
            font-size: 0.85rem; font-weight: 600; color: #1e293b;
            outline: none; cursor: pointer; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 1rem center; background-size: 1rem;
        }

        .scroller-wrapper {
            position: relative; height: 200px; overflow: hidden; display: flex;
            mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
        }
        .scroller-col { flex: 1; overflow-y: auto; padding: 75px 0; scrollbar-width: none; text-align: center; scroll-snap-type: y mandatory; }
        .scroller-item { padding: 10px; font-size: 1.1rem; color: #94a3b8; cursor: pointer; opacity: 0.5; scroll-snap-align: center; }
        .scroller-item.active { font-size: 1.5rem; font-weight: 800; color: #0f172a; opacity: 1; transform: scale(1.1); }
        .selection-indicator { position: absolute; top: 50%; left: 0; right: 0; height: 50px; transform: translateY(-50%); border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; pointer-events: none; z-index: -1; }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- === LEFT SIDEBAR (DESKTOP) === -->
    <div class="desktop-sidebar">
        <div>
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-slate-900 font-black text-xl shadow-lg">R</div>
                <div>
                    <h1 class="font-bold text-lg leading-none tracking-widest">RHADZOR</h1>
                </div>
            </div>

            <div class="space-y-4 mb-8">
                <p class="text-xs font-bold opacity-50 uppercase tracking-widest mb-2">Tampilan</p>
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium opacity-90">Hari Pasaran</span>
                    <input type="checkbox" class="toggle-switch" id="dsk-pasaran" onchange="toggleSetting('showPasaran')">
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium opacity-90">Kalender Hijriah</span>
                    <input type="checkbox" class="toggle-switch" id="dsk-hijri" onchange="toggleSetting('showHijri')">
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium opacity-90">Hari Peringatan Nasional</span>
                    <input type="checkbox" class="toggle-switch" id="dsk-obs" onchange="toggleSetting('showObservances')">
                </div>
            </div>

             <div class="space-y-2 mb-8">
                <p class="text-xs font-bold opacity-50 uppercase tracking-widest mb-1">Tema Warna</p>
                <button onclick="cycleTheme()" class="w-full bg-white/10 hover:bg-white/20 transition p-2 rounded-xl flex items-center justify-between px-4 font-bold text-sm">
                    <span id="themeNameDesktop">Royal Blue</span>
                    <i class="fas fa-palette"></i>
                </button>
            </div>

            <div class="space-y-2 mb-8">
                <p class="text-xs font-bold opacity-50 uppercase tracking-widest mb-1">Efek Transisi</p>
                <select class="premium-select" onchange="settings.transitionType = this.value">
                    <option value="slide">Slide (Klasik)</option>
                    <option value="cube">Cube Flip (3D)</option>
                    <option value="fade">Fade (Lembut)</option>
                    <option value="zoom">Zoom In/Out</option>
                    <option value="flip">Flip Card</option>
                </select>
            </div>

             <button onclick="goToToday()" class="w-full bg-white/10 hover:bg-white/20 transition p-3 rounded-xl flex items-center justify-center gap-2 mb-2 font-bold text-sm">
                <i class="fas fa-calendar-day"></i> Hari Ini
            </button>
            <button onclick="openDateSearch()" class="w-full bg-white/10 hover:bg-white/20 transition p-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm">
                <i class="fas fa-search"></i> Cari Tanggal
            </button>
        </div>

        <div class="text-center opacity-40 text-xs">
            &copy; 2026 Rhadzor Family<br>V10 Final
        </div>
    </div>

    <!-- === HEADER (MOBILE ONLY) === -->
    <header class="header-rhadzor">
        <div class="header-left">
            <div class="btn-setting" onclick="openSettings()">
                <i class="fas fa-cog"></i>
            </div>
        </div>
        <div class="header-center">
            <div class="flex items-center gap-2">
                <div class="nav-arrow" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></div>
                <div class="month-year-title">
                    <span id="monthLabelMobile" onclick="openMonthSelector()">JANUARI</span>
                    <span id="yearLabelMobile" onclick="openYearSelector()">2026</span>
                </div>
                <div class="nav-arrow" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></div>
            </div>
            <div class="hijri-label" id="hijriRangeMobile">RAJAB - SYA'BAN</div>
        </div>
        <div class="header-right">
            <div class="btn-today-icon" onclick="goToToday()">
                <i class="fas fa-calendar-day text-sm"></i>
            </div>
        </div>
    </header>

    <!-- === MAIN CONTENT === -->
    <main class="main-content">
        
        <div class="desktop-header-controls">
            <div>
                <h2 class="text-3xl font-black text-slate-800 tracking-tight" id="desktopMonthYear">JANUARI 2026</h2>
                <p class="text-sm text-slate-500 font-medium tracking-widest uppercase mt-1" id="desktopHijri">1447 HIJRIAH</p>
            </div>
            <div class="flex gap-2">
                <button onclick="changeMonth(-1)" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-700 transition"><i class="fas fa-chevron-left"></i></button>
                <button onclick="changeMonth(1)" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-700 transition"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <!-- WRAPPER KALENDER (STATIS DI MOBILE) -->
        <div class="calendar-section-mobile">
            <div class="calendar-card" id="swipeArea">
                <div class="calendar-grid-container" id="gridContainer">
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
        </div>

        <!-- WRAPPER KETERANGAN (SCROLL DI MOBILE) -->
        <!-- ID DITAMBAHKAN UNTUK SCROLLING LOGIC -->
        <div class="info-section-mobile" id="mobileInfoSection">
            <div class="space-y-2 mt-2" id="holidayContainerMobile"></div>
            <div class="quote-minimalist mt-8 text-center px-4 pb-8">
                <p class="text-xs text-slate-500 italic" id="quoteDisplayMobile">"Kata bijak di sini"</p>
            </div>
        </div>

    </main>

    <!-- === RIGHT PANEL (DESKTOP) === -->
    <div class="desktop-right-panel">
        <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Agenda Bulan Ini</h3>
        
        <div id="holidayContainerDesktop" class="space-y-3 event-list-container flex-1">
        </div>

        <div class="mt-auto pt-6 border-t border-slate-200">
            <i class="fas fa-quote-left text-slate-300 text-lg mb-2 block"></i>
            <p class="text-sm italic text-slate-600 font-medium leading-relaxed" id="quoteDisplayDesktop">Loading quote...</p>
        </div>
    </div>

    <!-- FOOTER (MOBILE ONLY - NEW DESIGN) -->
    <footer class="footer-rhadzor lg:hidden">
        <!-- Left: Theme Toggle -->
        <div onclick="cycleTheme()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/10 active:bg-white/20 transition cursor-pointer">
            <i class="fas fa-palette text-white text-sm"></i>
        </div>
        
        <!-- Center: Branding -->
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center text-white font-black text-xs backdrop-blur-sm border border-white/20">R</div>
            <span class="text-sm font-bold tracking-widest text-white uppercase">RHADZCAL</span>
        </div>

        <!-- Right: Search Button -->
        <div onclick="openDateSearch()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/10 active:bg-white/20 transition cursor-pointer">
            <i class="fas fa-search text-white text-sm"></i>
        </div>
    </footer>
</div>

<div class="modal-overlay" id="selectorModal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header-line"></div>
        <h3 id="modalTitle" class="text-center font-bold text-slate-800 mb-4 uppercase text-xs tracking-widest hidden">JUDUL MODAL</h3>
        
        <div id="modalBodyWrapper" class="flex-1 overflow-hidden flex flex-col">
            <div id="modalBody" class="w-full"></div>
        </div>
    </div>
</div>

<script>
    // --- DATABASE ---
    const quotes = [
        "Semakin kita mencari kebahagiaan, semakin jauh ia menghilang.", "Kegagalan terbesar adalah tidak pernah mencoba.", "Kata-kata terlembut bisa melukai paling dalam.", "Kita belajar paling banyak dari orang yang paling kita benci.", "Diam terkadang lebih berisik daripada teriakan.", "Kehilangan mengajarkan kita nilai memiliki.", "Kesendirian ramai, keramaian bisa sangat sunyi.", "Menerima adalah cara terkuat untuk melawan.", "Kita paling kuat saat mengakui kelemahan.", "Berubah adalah satu-satunya yang tetap.", "Makin banyak tahu, makin sadar tak tahu apa-apa.", "Waktu sembuhkan luka, waktu juga ciptakan luka.", "Cinta membebaskan dengan cara mengikat.", "Kesederhanaan butuh usaha yang rumit.", "Memberi adalah cara terbaik menerima.", "Memaafkan membebaskan yang memaafkan.", "Ketakutan terbesar adalah takut itu sendiri.", "Kontrol dimulai dari melepas kontrol.", "Kematian memberi arti pada kehidupan.", "Harapan bisa menjadi belenggu tersendiri.", "Kebenaran menyakitkan lebih baik dari kebohongan manis.", "Kesalahan masa lalu adalah guru terbaik hari ini.", "Semakin keras kita pegang, semakin mudah lepas.", "Pertanyaan lebih berharga daripada jawaban.", "Kegelapan mengajarkan kita menghargai cahaya.", "Kepastian adalah ilusi yang nyaman.", "Kita paling hidup saat hampir mati.", "Mendengar lebih sulit daripada berbicara.", "Kesuksesan dimulai dari kegagalan berulang.", "Kehilangan jalan adalah cara menemukan jalan baru.", "Keraguan adalah awal dari kebijaksanaan.", "Melambat terkadang cara tercepat sampai tujuan.", "Rasa sakit mengingatkan kita bahwa kita hidup.", "Mengenal diri sendiri adalah perjalanan seumur hidup.", "Kebahagiaan sejati datang dari dalam, bukan luar.", "Waktu tidak bisa dibeli tapi sering kita sia-siakan.", "Masalah terbesar sering punya solusi tersederhana.", "Kehilangan adalah bagian dari memiliki.", "Kesempurnaan adalah musuh dari kemajuan.", "Kita tumbuh paling cepat di luar zona nyaman.", "Yang kita takuti sering tidak pernah terjadi.", "Kebencian meracuni yang membenci.", "Berhenti adalah langkah maju terkadang.", "Mimpi tanpa aksi hanya angan-angan.", "Ketenangan lahir dari menerima kekacauan.", "Perpisahan mengajarkan arti kebersamaan.", "Kekuatan sejati adalah kelembutan.", "Hidup dimulai di ujung zona nyaman.", "Kesabaran adalah kekuatan yang tersembunyi.", "Melepas adalah bentuk kepemilikan tertinggi."
    ];

    const familyBirthdays = [
        { name: "Rhadzor", day: 28, month: 5, year: 1986 }, 
        { name: "Istri Tercinta ❤️❤️", day: 22, month: 6, year: 1988 }, 
        { name: "Alby", day: 3, month: 8, year: 2013 }, 
        { name: "Meka", day: 2, month: 3, year: 2020 }, 
        { name: "Sansa", day: 21, month: 3, year: 2022 } 
    ];

    const weddingAnniversary = { day: 23, month: 11, year: 2012 };

    const holidaysData = {
        2025: {
            0: { 1: "Tahun Baru 2025 Masehi", 27: "Isra Mikraj Nabi Muhammad SAW", 29: "Tahun Baru Imlek 2576 Kongzili" },
            2: { 29: "Hari Suci Nyepi (Tahun Baru Saka 1947)", 31: "Idul Fitri 1446 Hijriah" },
            3: { 1: "Idul Fitri 1446 Hijriah", 18: "Wafat Yesus Kristus", 20: "Kebangkitan Yesus Kristus (Paskah)" },
            4: { 1: "Hari Buruh Internasional", 12: "Hari Raya Waisak 2569 BE", 29: "Kenaikan Yesus Kristus" },
            5: { 1: "Hari Lahir Pancasila", 6: "Idul Adha 1446 Hijriah", 27: "1 Muharam Tahun Baru Islam 1447 Hijriah" },
            7: { 17: "Proklamasi Kemerdekaan RI" },
            8: { 5: "Maulid Nabi Muhammad SAW" },
            11: { 25: "Kelahiran Yesus Kristus (Natal)" }
        },
        2026: {
            0: { 1: "Tahun Baru 2026 Masehi", 16: "Isra Mikraj Nabi Muhammad SAW" },
            1: { 17: "Tahun Baru Imlek 2577 Kongzili" },
            2: { 19: "Hari Suci Nyepi (Tahun Baru Saka 1948)", 21: "Idul Fitri 1447 Hijriah", 22: "Idul Fitri 1447 Hijriah" },
            3: { 3: "Wafat Yesus Kristus", 5: "Kebangkitan Yesus Kristus (Paskah)" },
            4: { 1: "Hari Buruh Internasional", 14: "Kenaikan Yesus Kristus", 27: "Idul Adha 1447 Hijriah", 31: "Hari Raya Waisak 2570 BE" },
            5: { 1: "Hari Lahir Pancasila", 16: "1 Muharam Tahun Baru Islam 1448 Hijriah" },
            7: { 17: "Proklamasi Kemerdekaan RI", 25: "Maulid Nabi Muhammad SAW" },
            11: { 25: "Kelahiran Yesus Kristus (Natal)" }
        }
    };

    const cutiBersamaData = {
        2025: {
            0: { 28: "Cuti Bersama Imlek 2576" },
            2: { 28: "Cuti Bersama Nyepi Saka 1947" },
            3: { 2: "Cuti Bersama Idul Fitri", 3: "Cuti Bersama Idul Fitri", 4: "Cuti Bersama Idul Fitri", 7: "Cuti Bersama Idul Fitri" },
            4: { 13: "Cuti Bersama Waisak", 30: "Cuti Bersama Kenaikan Yesus Kristus" },
            5: { 9: "Cuti Bersama Idul Adha" },
            7: { 18: "Cuti Bersama Proklamasi Kemerdekaan" },
            11: { 26: "Cuti Bersama Natal" }
        },
        2026: {
            1: { 16: "Cuti Bersama Imlek 2577" },
            2: { 18: "Cuti Bersama Nyepi Saka 1948", 20: "Cuti Bersama Idul Fitri", 23: "Cuti Bersama Idul Fitri", 24: "Cuti Bersama Idul Fitri" },
            4: { 15: "Cuti Bersama Kenaikan Yesus Kristus", 28: "Cuti Bersama Idul Adha" },
            11: { 24: "Cuti Bersama Natal" }
        }
    };

    const nationalObservances = {
        0: { 3: "Hari Amal Bhakti Kemenag RI", 5: "Hari KOWAL", 10: "Hari Tritura", 15: "Hari Dharma Samudera", 17: "Hari Raya Siwaratri", 23: "Hari Patriotik", 25: "Hari Gizi Nasional", 31: "Harlah NU" },
        1: { 5: "Peristiwa Kapal Tujuh", 9: "Hari Pers Nasional (HPN)", 14: "Peringatan PETA", 21: "Hari Peduli Sampah Nasional", 28: "Hari Gizi Nasional" },
        2: { 1: "Serangan Umum 1 Maret", 9: "Hari Musik Nasional", 30: "Hari Film Nasional" },
        3: { 6: "Hari Nelayan Indonesia", 9: "Hari TNI AU", 16: "Hari Kopassus", 21: "Hari Kartini", 27: "Hari Pemasyarakatan", 28: "Hari Puisi Nasional" },
        4: { 2: "Hardiknas", 17: "Hari Buku Nasional", 20: "Hari Kebangkitan Nasional", 29: "Hari Lanjut Usia Nasional" },
        5: { 21: "Hari Krida Pertanian", 24: "Hari Bidan Nasional", 29: "Hari KB" },
        6: { 1: "Hari Bhayangkara", 5: "Hari Bank Indonesia", 12: "Hari Koperasi Indonesia", 22: "Hari Kejaksaan", 23: "Hari Anak Nasional" },
        7: { 5: "Hari Dharma Wanita", 10: "Hari Veteran Nasional", 14: "Hari Pramuka", 21: "Hari Maritim Nasional", 24: "Hari TVRI" },
        8: { 1: "Hari Polwan", 3: "Hari PMI", 4: "Hari Pelanggan Nasional", 9: "Hari Olahraga Nasional", 17: "Hari Perhubungan Nasional", 24: "Hari Tani Nasional", 28: "Hari Kereta Api", 30: "Peringatan G30S/PKI" },
        9: { 1: "Hari Kesaktian Pancasila", 2: "Hari Batik Nasional", 5: "Hari TNI", 24: "Hari Dokter Indonesia", 27: "Hari Listrik Nasional", 28: "Hari Sumpah Pemuda", 30: "Hari Keuangan Nasional" },
        10: { 5: "Hari Cinta Puspa & Satwa", 10: "Hari Pahlawan", 12: "Hari Kesehatan / Hari Ayah", 14: "Hari Brimob", 25: "Hari Guru", 28: "Hari Menanam Pohon", 29: "Hari KORPRI" },
        11: { 12: "Hari Transmigrasi", 13: "Hari Nusantara", 19: "Hari Bela Negara", 22: "Hari Ibu" }
    };

    const hijriMonths = ["MUHARRAM", "SAFAR", "RABIUL AWAL", "RABIUL AKHIR", "JUMADIL AWAL", "JUMADIL AKHIR", "RAJAB", "SYA'BAN", "RAMADHAN", "SYAWAL", "DZULQA'DAH", "DZULHIJJAH"];
    const pasaranArr = ["LEGI", "PAHING", "PON", "WAGE", "KLIWON"];
    const monthNames = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
    const dayNames = ["MINGGU", "SENIN", "SELASA", "RABU", "KAMIS", "JUMAT", "SABTU"];
    const dayShortNames = ["MGG", "SEN", "SEL", "RAB", "KAM", "JUM", "SAB"];

    // Theme Configuration
    const themes = [
        { id: 'royal', name: 'Royal Blue', class: '' },
        { id: 'emerald', name: 'Emerald', class: 'theme-emerald' },
        { id: 'amethyst', name: 'Amethyst', class: 'theme-amethyst' },
        { id: 'crimson', name: 'Crimson', class: 'theme-crimson' }
    ];
    let currentThemeIndex = 0;

    let currentDate = new Date();
    let isAnimating = false;
    let highlightTriggered = false; 
    
    let settings = {
        showHijri: true,
        showPasaran: true,
        showObservances: true,
        showFamily: true,
        transitionType: 'slide' 
    };

    function init() {
        syncSettingsUI();
        renderCalendar();
        updateQuote();
        setupSwipe();
        window.addEventListener('resize', renderCalendar);
    }

    function syncSettingsUI() {
        document.getElementById('dsk-pasaran').checked = settings.showPasaran;
        document.getElementById('dsk-hijri').checked = settings.showHijri;
        document.getElementById('dsk-obs').checked = settings.showObservances;
    }

    // THEME SWITCHER LOGIC
    function cycleTheme() {
        currentThemeIndex = (currentThemeIndex + 1) % themes.length;
        const theme = themes[currentThemeIndex];
        
        // Remove all theme classes
        document.body.className = '';
        if (theme.class) {
            document.body.classList.add(theme.class);
        }
        
        document.getElementById('themeNameDesktop').textContent = theme.name;
    }

    function getHijriDate(date) {
        let julian = Math.floor((date.getTime() / 86400000) + 2440587.5);
        let l = julian - 1948440 + 10632;
        let n = Math.floor((l - 1) / 10631);
        l = l - 10631 * n + 354;
        let j = (Math.floor((10985 - l) / 5316)) * (Math.floor((50 * l) / 17719)) + (Math.floor(l / 5670)) * (Math.floor((43 * l) / 15238));
        l = l - (Math.floor((30 - j) / 15)) * (Math.floor((17719 * j) / 50)) - (Math.floor(j / 16)) * (Math.floor((15238 * j) / 43)) + 29;
        let m = Math.floor((24 * l) / 709);
        let d = l - Math.floor((709 * m) / 24);
        let y = 30 * n + j - 30;
        
        if (date.getFullYear() === 2026 && date.getMonth() === 2 && date.getDate() === 21) {
            return { day: 1, month: 9, year: y }; 
        }
        
        return { day: d, month: m - 1, year: y };
    }

    function getHolidayName(d, m, y) {
        if (holidaysData[y] && holidaysData[y][m] && holidaysData[y][m][d]) return holidaysData[y][m][d];
        return null;
    }
    function getCutiBersamaName(d, m, y) {
        if (cutiBersamaData[y] && cutiBersamaData[y][m] && cutiBersamaData[y][m][d]) return cutiBersamaData[y][m][d];
        return null;
    }
    function getObservanceName(d, m) {
        if (settings.showObservances && nationalObservances[m] && nationalObservances[m][d]) return nationalObservances[m][d];
        return null;
    }
    function getBirthday(d, m) {
        if (!settings.showFamily) return null;
        return familyBirthdays.find(b => b.day === d && b.month === m);
    }
    function isAnniversary(d, m) {
        if (!settings.showFamily) return null;
        return weddingAnniversary.day === d && weddingAnniversary.month === m;
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const now = new Date();
        const isCurrentMonthYear = (now.getFullYear() === year && now.getMonth() === month);
        const todayDayNum = now.getDate();
        
        document.getElementById('monthLabelMobile').textContent = monthNames[month];
        document.getElementById('yearLabelMobile').textContent = year;
        document.getElementById('desktopMonthYear').textContent = `${monthNames[month]} ${year}`;
        
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDay = new Date(year, month, 1).getDay();
        
        const startH = getHijriDate(new Date(year, month, 1));
        const endH = getHijriDate(new Date(year, month, daysInMonth));
        const hijriStr = `${hijriMonths[startH.month]} - ${hijriMonths[endH.month]}`;
        
        document.getElementById('hijriRangeMobile').textContent = hijriStr;
        document.getElementById('desktopHijri').textContent = hijriStr + " 1447H";
        
        const d_hijri = settings.showHijri ? 'block' : 'none';
        document.getElementById('hijriRangeMobile').style.display = d_hijri;
        document.getElementById('desktopHijri').style.display = d_hijri;

        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        
        dayShortNames.forEach(d => {
            const el = document.createElement('div');
            el.className = 'day-label';
            el.textContent = d;
            grid.appendChild(el);
        });

        const totalCells = 42;
        const prevMonthLastDate = new Date(year, month, 0).getDate();

        for (let i = 0; i < totalCells; i++) {
            const cell = document.createElement('div');
            let displayDate, targetMonth, targetYear, isOtherMonth = false;

            if (i < firstDay) {
                displayDate = prevMonthLastDate - (firstDay - i - 1);
                targetMonth = month - 1;
                targetYear = year;
                isOtherMonth = true;
            } else if (i < firstDay + daysInMonth) {
                displayDate = i - firstDay + 1;
                targetMonth = month;
                targetYear = year;
            } else {
                displayDate = i - (firstDay + daysInMonth) + 1;
                targetMonth = month + 1;
                targetYear = year;
                isOtherMonth = true;
            }

            const dateObj = new Date(targetYear, targetMonth, displayDate);
            const actualDay = dateObj.getDate();
            const actualMonth = dateObj.getMonth();
            const actualYear = dateObj.getFullYear();

            if (isOtherMonth) {
                cell.className = 'day-cell other-month';
                cell.innerHTML = `<span class="date-wrapper">${actualDay}</span>`;
            } else {
                const isToday = isCurrentMonthYear && actualDay === todayDayNum;
                const h = getHijriDate(dateObj);
                const dayOfWeek = dateObj.getDay();
                const isSunday = dayOfWeek === 0;
                const isFriday = dayOfWeek === 5;
                
                const holidayName = getHolidayName(actualDay, actualMonth, actualYear);
                const isHoliday = !!holidayName;
                const cutiName = getCutiBersamaName(actualDay, actualMonth, actualYear);
                const observanceName = getObservanceName(actualDay, actualMonth);
                const birthdayData = getBirthday(actualDay, actualMonth);
                const anniversaryData = isAnniversary(actualDay, actualMonth);
                
                const refDate = new Date(2026, 0, 1);
                const diff = Math.floor((dateObj - refDate) / 86400000);
                const pasaranIdx = (3 + (diff % 5) + 5) % 5;
                
                let cellClass = `day-cell ${isToday ? 'today' : ''}`;
                if (isToday && highlightTriggered) {
                    cellClass += ' today-jump-animation';
                }

                if (anniversaryData) cellClass += ' anniversary';
                else if (birthdayData) cellClass += ' birthday';
                else if (isSunday || isHoliday) cellClass += ' sunday';
                else if (isFriday) cellClass += ' friday';
                
                cell.className = cellClass;
                const hijriClass = settings.showHijri ? 'hijri-text' : 'hijri-text hidden-element';
                const pasaranClass = settings.showPasaran ? 'pasaran-text' : 'pasaran-text hidden-element';
                
                const cutiDotHTML = !!cutiName ? `<div class="cuti-dot"></div>` : '';
                const obsDotHTML = !!observanceName ? `<div class="obs-dot"></div>` : '';

                cell.innerHTML = `
                    <span class="${hijriClass}">${h.day}</span>
                    <span class="date-wrapper">${actualDay}${cutiDotHTML}${obsDotHTML}</span>
                    <span class="${pasaranClass}">${pasaranArr[pasaranIdx]}</span>
                `;
                
                cell.onclick = () => showDetail(actualDay, actualMonth, actualYear, dayNames[dayOfWeek], pasaranArr[pasaranIdx], h.day, hijriMonths[h.month], holidayName, cutiName, observanceName, isSunday, birthdayData, anniversaryData);
            }
            grid.appendChild(cell);
        }
        renderEventsList(month, year);
        
        if (highlightTriggered) {
            setTimeout(() => { highlightTriggered = false; }, 2000);
        }
    }

    function renderEventsList(month, year) {
        let htmlContent = '';
        const realToday = new Date();
        const tDay = realToday.getDate();
        const tMonth = realToday.getMonth();
        const tYear = realToday.getFullYear();

        if (settings.showFamily && weddingAnniversary.month === month) {
            const annAge = year - weddingAnniversary.year;
            if (annAge > 0) {
                const isToday = (weddingAnniversary.day === tDay && month === tMonth);
                htmlContent += `
                <div class="anniversary-item ${isToday ? 'highlight-today' : ''} flex justify-between items-center cursor-pointer hover:scale-[1.02] transition">
                    <div class="flex flex-col">
                        <span class="text-[0.7rem] font-bold text-pink-800">${weddingAnniversary.day} ${monthNames[month]}</span>
                        <span class="text-[0.6rem] text-pink-600 font-semibold">Anniversary Pernikahan ❤️</span>
                    </div>
                    <span class="text-[0.65rem] font-bold text-pink-700 bg-pink-100 px-2 py-1 rounded-full">Ke-${annAge}</span>
                </div>`;
            }
        }

        if (settings.showFamily) {
            const monthBirthdays = familyBirthdays.filter(b => b.month === month).sort((a,b) => a.day - b.day);
            monthBirthdays.forEach(b => {
                const age = year - b.year;
                const isToday = (b.day === tDay && month === tMonth);
                htmlContent += `
                <div class="birthday-item ${isToday ? 'highlight-today' : ''} flex justify-between items-center cursor-pointer hover:scale-[1.02] transition">
                    <div class="flex flex-col">
                        <span class="text-[0.7rem] font-bold text-amber-800">${b.day} ${monthNames[month]}</span>
                        <span class="text-[0.6rem] text-amber-600 font-semibold truncate w-32">Ulang Tahun ${b.name}</span>
                    </div>
                    <span class="text-[0.65rem] font-bold text-amber-700 bg-amber-100 px-2 py-1 rounded-full">Ke-${age}</span>
                </div>`;
            });
        }

        let mergedEvents = [];
        if (holidaysData[year] && holidaysData[year][month]) {
            Object.keys(holidaysData[year][month]).forEach(d => mergedEvents.push({ day: parseInt(d), name: holidaysData[year][month][d], type: 'holiday' }));
        }
        if (cutiBersamaData[year] && cutiBersamaData[year][month]) {
            Object.keys(cutiBersamaData[year][month]).forEach(d => mergedEvents.push({ day: parseInt(d), name: cutiBersamaData[year][month][d], type: 'cuti' }));
        }
        if (settings.showObservances && nationalObservances[month]) {
            Object.keys(nationalObservances[month]).forEach(d => mergedEvents.push({ day: parseInt(d), name: nationalObservances[month][d], type: 'observance' }));
        }
        mergedEvents.sort((a, b) => a.day - b.day);

        mergedEvents.forEach(evt => {
            const isObs = evt.type === 'observance';
            const colorClass = isObs ? 'text-blue-600' : 'text-red-600';
            const isToday = (evt.day === tDay && month === tMonth && year === tYear);
            
            // Tambahkan ID unik untuk scrolling jika hari ini
            const todayId = isToday ? 'today-event-highlight' : '';

            htmlContent += `
            <div id="${todayId}" class="${isObs ? 'observance-item' : 'holiday-item'} ${isToday ? 'highlight-today' : ''} flex justify-between items-center cursor-pointer hover:scale-[1.02] transition">
                <span class="text-[0.7rem] font-bold text-slate-800">${evt.day} ${monthNames[month]}</span>
                <span class="text-[0.65rem] ${colorClass} font-medium text-right w-2/3 leading-tight">${evt.name}</span>
            </div>`;
        });

        document.getElementById('holidayContainerMobile').innerHTML = htmlContent;
        document.getElementById('holidayContainerDesktop').innerHTML = htmlContent;

        // --- RESET & AUTO SCROLL LOGIC ---
        const mobileContainer = document.getElementById('mobileInfoSection');
        if (mobileContainer) {
            // 1. Reset scroll ke atas dulu setiap kali render ulang
            mobileContainer.scrollTop = 0;

            // 2. Cek apakah ada event hari ini
            setTimeout(() => {
                const todayEvent = document.querySelector('.highlight-today');
                if (todayEvent) {
                    // Jika ada, scroll ke elemen tersebut
                    todayEvent.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
                }
            }, 600); 
        }
    }

    function goToToday() {
        const now = new Date();
        const isSameMonthYear = (currentDate.getFullYear() === now.getFullYear() && currentDate.getMonth() === now.getMonth());
        
        highlightTriggered = true; 
        
        if (isSameMonthYear) {
            renderCalendar();
        } else {
            const dir = (now.getFullYear() > currentDate.getFullYear() || (now.getFullYear() === now.getFullYear() && now.getMonth() > currentDate.getMonth())) ? 1 : -1;
            const originalTransition = settings.transitionType;
            settings.transitionType = 'zoom';
            changeMonth(dir, now);
            setTimeout(() => {
                settings.transitionType = originalTransition;
            }, 1000);
        }
    }

    function updateQuote() {
        const idx = Math.floor(Math.random() * quotes.length);
        const q = `"${quotes[idx]}"`;
        document.getElementById('quoteDisplayMobile').textContent = q;
        document.getElementById('quoteDisplayDesktop').textContent = q;
    }

    function changeMonth(dir, targetDate = null) {
        if (isAnimating) return;
        isAnimating = true;
        const container = document.getElementById('gridContainer');
        const type = settings.transitionType;
        
        const applyTransitionOut = () => {
            container.style.opacity = '0';
            switch(type) {
                case 'slide':
                    container.style.transform = dir > 0 ? 'translateX(-15%)' : 'translateX(15%)';
                    break;
                case 'cube':
                    container.style.transformOrigin = dir > 0 ? 'left center' : 'right center';
                    container.style.transform = dir > 0 ? 'rotateY(-90deg) scale(0.85) translateZ(50px)' : 'rotateY(90deg) scale(0.85) translateZ(50px)';
                    break;
                case 'zoom':
                    container.style.transform = 'scale(0.8)';
                    break;
                case 'flip':
                    container.style.transform = 'rotateY(180deg)';
                    break;
                case 'fade':
                    break;
            }
        };

        const applyTransitionIn = () => {
            container.style.transition = 'none';
            switch(type) {
                case 'slide':
                    container.style.transform = dir > 0 ? 'translateX(15%)' : 'translateX(-15%)';
                    break;
                case 'cube':
                    container.style.transformOrigin = dir > 0 ? 'right center' : 'left center';
                    container.style.transform = dir > 0 ? 'rotateY(90deg) scale(0.85) translateZ(50px)' : 'rotateY(-90deg) scale(0.85) translateZ(50px)';
                    break;
                case 'zoom':
                    container.style.transform = 'scale(1.2)';
                    break;
                case 'flip':
                    container.style.transform = 'rotateY(-180deg)';
                    break;
            }
        };

        const resetTransition = () => {
            const duration = type === 'cube' || type === 'flip' ? '0.5s' : '0.4s';
            const easing = type === 'cube' ? 'cubic-bezier(0.175, 0.885, 0.32, 1.275)' : 'cubic-bezier(0.4, 0, 0.2, 1)';
            container.style.transition = `transform ${duration} ${easing}, opacity 0.3s`;
            container.style.transform = 'translateX(0) rotateY(0deg) scale(1) translateZ(0)';
            container.style.opacity = '1';
        };

        applyTransitionOut();
        
        setTimeout(() => {
            if (targetDate) {
                currentDate = new Date(targetDate);
            } else {
                currentDate.setDate(1); 
                currentDate.setMonth(currentDate.getMonth() + dir);
            }
            renderCalendar();
            updateQuote();
            
            applyTransitionIn();
            
            setTimeout(() => {
                resetTransition();
                setTimeout(() => isAnimating = false, 500);
            }, 50);
        }, 250);
    }

    function openSettings() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden'); title.textContent = "PENGATURAN";
        body.className = "p-4 space-y-4";
        
        const makeToggle = (label, key) => `
            <div class="flex justify-between items-center p-2 bg-slate-50 rounded-xl">
                <span class="font-bold text-sm text-slate-700">${label}</span>
                <input type="checkbox" class="toggle-switch" ${settings[key] ? 'checked' : ''} onchange="toggleSetting('${key}')">
            </div>`;
            
        let html = 
            makeToggle('Hari Pasaran', 'showPasaran') +
            makeToggle('Kalender Hijriah', 'showHijri') +
            makeToggle('Hari Peringatan Nasional', 'showObservances') +
            makeToggle('Rhadz Calendar', 'showFamily');
            
        html += `
            <div class="pt-2">
                <span class="block font-bold text-[0.65rem] text-slate-400 uppercase tracking-widest mb-2 px-1">Efek Transisi Bulan</span>
                <select class="premium-select" onchange="settings.transitionType = this.value">
                    <option value="slide" ${settings.transitionType === 'slide' ? 'selected' : ''}>Slide (Klasik)</option>
                    <option value="cube" ${settings.transitionType === 'cube' ? 'selected' : ''}>Cube Flip (3D)</option>
                    <option value="fade" ${settings.transitionType === 'fade' ? 'selected' : ''}>Fade (Lembut)</option>
                    <option value="zoom" ${settings.transitionType === 'zoom' ? 'selected' : ''}>Zoom In/Out</option>
                    <option value="flip" ${settings.transitionType === 'flip' ? 'selected' : ''}>Flip Card</option>
                </select>
            </div>
        `;
            
        body.innerHTML = html;
        openModal();
    }

    function toggleSetting(key) {
        settings[key] = !settings[key];
        syncSettingsUI();
        renderCalendar(); 
    }

    function createScrollerItem(text, value, isActive) {
        const item = document.createElement('div');
        item.className = `scroller-item ${isActive ? 'active' : ''}`;
        item.textContent = text;
        item.dataset.value = value;
        return item;
    }
    
    function setupScrollSnapObserver(containerId) {
        const container = document.getElementById(containerId);
        let scrollTimeout;
        container.onscroll = () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const center = container.scrollTop + (container.clientHeight / 2);
                const items = container.querySelectorAll('.scroller-item');
                let closest = null; let minDiff = Infinity;
                items.forEach(item => {
                    const itemCenter = item.offsetTop + (item.offsetHeight / 2);
                    const diff = Math.abs(center - itemCenter);
                    if (diff < minDiff) { minDiff = diff; closest = item; }
                    item.classList.remove('active');
                });
                if (closest) closest.classList.add('active');
            }, 50);
        };
    }

    function openMonthSelector() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden'); title.textContent = "PILIH BULAN";
        body.className = "grid grid-cols-3 gap-3 p-2";
        body.innerHTML = '';
        monthNames.forEach((m, i) => {
            const div = document.createElement('div');
            div.className = `p-3 text-center rounded-xl font-bold text-[0.75rem] cursor-pointer transition ${currentDate.getMonth() === i ? 'bg-slate-900 text-white shadow-lg' : 'bg-slate-50 text-slate-600 hover:bg-slate-100'}`;
            div.textContent = m;
            div.onclick = () => { currentDate.setMonth(i); renderCalendar(); closeModal(); };
            body.appendChild(div);
        });
        openModal();
    }

    function openYearSelector() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden'); title.textContent = "PILIH TAHUN";
        body.className = "w-full";
        const currentYear = currentDate.getFullYear();
        body.innerHTML = `
            <div class="scroller-wrapper">
                <div class="selection-indicator"></div>
                <div class="scroller-col" id="yearListScroll"></div>
            </div>
            <button onclick="selectHighlightedYear()" class="w-full mt-4 bg-slate-900 text-white p-3 rounded-xl font-bold text-xs tracking-wider">PILIH TAHUN</button>
        `;
        const list = document.getElementById('yearListScroll');
        for(let y = currentYear - 100; y <= currentYear + 100; y++) {
            list.appendChild(createScrollerItem(y, y, y === currentYear));
        }
        openModal();
        setupScrollSnapObserver('yearListScroll');
        setTimeout(() => {
            const active = list.querySelector('.active');
            if(active) active.scrollIntoView({ block: 'center' });
        }, 100);
    }

    function selectHighlightedYear() {
        const activeEl = document.querySelector('#yearListScroll .active');
        if(activeEl) {
            currentDate.setFullYear(parseInt(activeEl.dataset.value));
            renderCalendar(); closeModal();
        }
    }

    function openDateSearch() {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.remove('hidden'); title.textContent = "CARI TANGGAL";
        body.className = "w-full";
        const curM = currentDate.getMonth(); const curY = currentDate.getFullYear();
        body.innerHTML = `
            <div class="scroller-wrapper">
                <div class="selection-indicator"></div>
                <div class="scroller-col" id="monthScroller"></div>
                <div class="scroller-col" id="yearScroller"></div>
            </div>
            <button onclick="jumpToSelectedMonthYear()" class="w-full mt-4 bg-slate-900 text-white p-3 rounded-xl font-bold text-xs tracking-wider">LIHAT KALENDER</button>
        `;
        const mList = document.getElementById('monthScroller');
        const yList = document.getElementById('yearScroller');
        monthNames.forEach((m, i) => { mList.appendChild(createScrollerItem(m, i, i === curM)); });
        for(let y = curY - 50; y <= curY + 50; y++) { yList.appendChild(createScrollerItem(y, y, y === curY)); }
        openModal();
        setupScrollSnapObserver('monthScroller'); setupScrollSnapObserver('yearScroller');
        setTimeout(() => {
            const activeM = mList.querySelector('.active'); const activeY = yList.querySelector('.active');
            if(activeM) activeM.scrollIntoView({ block: 'center' });
            if(activeY) activeY.scrollIntoView({ block: 'center' });
        }, 100);
    }

    function jumpToSelectedMonthYear() {
        const activeM = document.querySelector('#monthScroller .active');
        const activeY = document.querySelector('#yearScroller .active');
        if(activeM && activeY) {
            currentDate.setDate(1);
            currentDate.setMonth(parseInt(activeM.dataset.value));
            currentDate.setFullYear(parseInt(activeY.dataset.value));
            renderCalendar(); updateQuote(); closeModal();
        }
    }

    function showDetail(d, m, y, dayName, pasaranName, hDate, hMonth, holiday, cutiName, observanceName, isSunday, birthdayData, anniversaryData) {
        const body = document.getElementById('modalBody');
        const title = document.getElementById('modalTitle');
        title.classList.add('hidden');
        body.className = "p-4 text-center";
        
        const detailQuote = quotes[Math.floor(Math.random() * quotes.length)];
        const isRedDay = isSunday || !!holiday;
        
        let dateColor = isRedDay ? "text-red-600" : "text-slate-900";
        let subColor = isRedDay ? "text-red-400" : "text-slate-400";
        if(birthdayData) { dateColor = "text-amber-600"; subColor = "text-amber-400"; }
        else if (anniversaryData) { dateColor = "text-pink-600"; subColor = "text-pink-400"; }

        let specialBadge = '';
        
        if (birthdayData) {
            const age = y - birthdayData.year;
            specialBadge += `<div class="mt-2 px-3 py-1 bg-amber-100 text-amber-700 rounded-full font-bold text-[0.65rem] uppercase tracking-wide border border-amber-200 inline-block mx-1 mb-1">🎉 ULTAH ${birthdayData.name} KE-${age}</div>`;
        }
        if (anniversaryData) {
            const annAge = y - weddingAnniversary.year;
            specialBadge += `<div class="mt-2 px-3 py-1 bg-pink-100 text-pink-700 rounded-full font-bold text-[0.65rem] uppercase tracking-wide border border-pink-200 inline-block mx-1 mb-1">💍 ANNIVERSARY KE-${annAge}</div>`;
        }

        if (holiday) specialBadge += `<div class="mt-2 px-3 py-1 bg-red-100 text-red-600 rounded-full font-bold text-[0.65rem] uppercase tracking-wide border border-red-200 inline-block mx-1 mb-1">${holiday}</div>`;
        if (cutiName) specialBadge += `<div class="mt-2 px-3 py-1 bg-red-50 text-red-500 rounded-full font-bold text-[0.65rem] uppercase tracking-wide border border-red-200 inline-block mx-1 mb-1">${cutiName}</div>`;
        if (observanceName) specialBadge += `<div class="mt-2 px-3 py-1 bg-blue-50 text-blue-500 rounded-full font-bold text-[0.65rem] uppercase tracking-wide border border-blue-200 inline-block mx-1 mb-1">${observanceName}</div>`;

        const pasaranText = settings.showPasaran ? pasaranName : '';
        const hijriTextDisplay = settings.showHijri ? `${hDate} ${hMonth} 1447H` : '';

        body.innerHTML = `
            <div class="flex flex-col items-center justify-center mb-6">
                <div class="text-6xl font-black ${dateColor} leading-none tracking-tighter">${d}</div>
                <div class="text-xs font-bold ${subColor} uppercase mt-1 tracking-widest mb-1">${monthNames[m]} ${y}</div>
                 ${specialBadge}
            </div>
            <div class="bg-white border border-slate-100 rounded-3xl p-4 shadow-sm mb-5">
                <div class="text-xl font-black text-slate-800 uppercase tracking-tight">${dayName} ${pasaranText}</div>
                <div class="text-sm font-medium text-slate-500 mt-1">${hijriTextDisplay}</div> 
            </div>
            <div class="p-5 bg-slate-50 rounded-3xl border border-slate-100 mb-4">
                <i class="fas fa-quote-left text-slate-300 text-xl mb-2 block text-center"></i>
                <p class="text-sm italic text-slate-600 leading-relaxed font-medium text-center">"${detailQuote}"</p>
            </div>
        `;
        openModal();
    }

    function openModal() { document.getElementById('selectorModal').classList.add('active'); }
    function closeModal() { document.getElementById('selectorModal').classList.remove('active'); }

    function setupSwipe() {
        let startX = 0;
        const area = document.getElementById('swipeArea');
        area.addEventListener('touchstart', e => { startX = e.changedTouches[0].screenX; }, {passive: false});
        area.addEventListener('touchend', e => { 
            const endX = e.changedTouches[0].screenX;
            if (endX < startX - 60) changeMonth(1);
            if (endX > startX + 60) changeMonth(-1);
        }, {passive: false});
    }

    window.onload = init;
</script>
</body>
</html>
